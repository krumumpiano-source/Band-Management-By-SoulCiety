<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>ตั้งค่าวง — Band Management By SoulCiety</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;700&family=Sarabun:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/theme.css">
  <link rel="stylesheet" href="css/nav.css">
  <link rel="stylesheet" href="css/compat.css">
  <style>
    .info-grid{display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-md)}
    @media(max-width:600px){.info-grid{grid-template-columns:1fr}}

    /* Invite code */
    .invite-box{background:linear-gradient(135deg,#1a202c,#2d3748);border:1px solid var(--premium-gold);border-radius:var(--radius-lg);padding:var(--spacing-lg);margin-top:var(--spacing-md)}
    .invite-code-display{font-family:monospace;font-size:2rem;font-weight:700;letter-spacing:.25em;color:var(--premium-gold);text-align:center;padding:14px;background:#111827;border-radius:var(--radius-md);margin:var(--spacing-md) 0;cursor:pointer;user-select:all;transition:background .15s}
    .invite-code-display:hover{background:#1f2937}
    .invite-code-display.empty{font-size:var(--text-sm);color:#4b5563;letter-spacing:normal;font-weight:400;font-family:inherit}
    .invite-actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
    .invite-hint{font-size:var(--text-xs);color:#6b7280;text-align:center;margin-top:8px}
    .invite-expires{font-size:var(--text-xs);color:#9ca3af;text-align:center;margin-top:2px;min-height:16px}

    /* Members */
    .member-item{display:flex;align-items:flex-end;gap:var(--spacing-md);padding:var(--spacing-md);background:var(--premium-off-white);border-radius:var(--radius-md);margin-bottom:var(--spacing-sm);flex-wrap:wrap}
    .member-item .form-group{flex:1;min-width:130px;margin-bottom:0}
    .member-remove{padding:8px 12px;background:#e53e3e;color:#fff;border:none;border-radius:var(--radius-sm);cursor:pointer;font-size:15px;flex-shrink:0;align-self:flex-end}

    /* Venue accordion — ① ร้าน → ② วัน → ③ เวลา → ④ สมาชิก */
    .venue-accordion-item{background:var(--premium-white);border:1px solid #e2e8f0;border-radius:var(--radius-lg);margin-bottom:var(--spacing-md);overflow:hidden;transition:box-shadow .15s}
    .venue-accordion-item:hover{box-shadow:0 2px 8px rgba(0,0,0,.08)}
    .venue-accordion-header{display:flex;align-items:center;gap:12px;padding:var(--spacing-md) var(--spacing-lg);cursor:pointer;background:linear-gradient(135deg,#1a202c,#2d3748);user-select:none;transition:background .15s}
    .venue-accordion-header:hover{background:linear-gradient(135deg,#232d3f,#374151)}
    .venue-expand-arrow{color:var(--premium-gold);font-size:13px;flex-shrink:0;width:18px;text-align:center}
    .venue-header-info{flex:1;min-width:0}
    .venue-header-name{font-weight:700;color:#f3f4f6;font-size:var(--text-sm)}
    .venue-header-summary{font-size:var(--text-xs);color:#9ca3af;margin-top:2px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .venue-remove-btn{padding:6px 10px;background:rgba(229,62,62,.15);border:1px solid rgba(229,62,62,.4);color:#f87171;border-radius:var(--radius-sm);cursor:pointer;font-size:13px;flex-shrink:0;transition:all .15s}
    .venue-remove-btn:hover{background:#e53e3e;color:#fff}
    .venue-accordion-body{padding:var(--spacing-lg);border-top:2px solid #111827}
    .venue-step-section{margin-bottom:var(--spacing-lg)}
    .venue-step-section:last-child{margin-bottom:0}
    .venue-step-label{display:flex;align-items:center;gap:8px;font-size:var(--text-xs);font-weight:700;color:var(--premium-text-muted);text-transform:uppercase;letter-spacing:.06em;margin-bottom:var(--spacing-sm)}
    .step-num{display:inline-flex;align-items:center;justify-content:center;width:20px;height:20px;background:var(--premium-gold);color:#1a202c;border-radius:50%;font-size:11px;font-weight:800;flex-shrink:0}
    .venue-info-inputs{display:flex;gap:var(--spacing-md);flex-wrap:wrap}
    .venue-info-inputs .form-group{flex:1;min-width:130px;margin-bottom:0}
    .venue-day-content{background:rgba(249,207,69,.03);border:1px solid rgba(249,207,69,.18);border-radius:var(--radius-md);padding:var(--spacing-md);margin-top:4px}
    .day-tabs{display:flex;flex-wrap:wrap;gap:6px}
    .day-tab{padding:6px 12px;background:var(--premium-off-white);border:2px solid #e2e8f0;border-radius:var(--radius-md);cursor:pointer;font-size:var(--text-xs);font-weight:600;font-family:inherit;transition:all .15s;position:relative}
    .day-tab.active{background:var(--premium-gold);color:#1a202c;border-color:var(--premium-gold)}
    .day-tab.has-data{border-color:var(--premium-gold);color:var(--premium-gold)}
    .day-tab.active.has-data{color:#1a202c}
    .day-tab.has-data::after{content:'';position:absolute;top:3px;right:3px;width:5px;height:5px;background:var(--premium-gold);border-radius:50%}
    .day-tab.active.has-data::after{background:#1a202c}
    .time-slot-item{background:var(--premium-white);border-radius:var(--radius-md);padding:var(--spacing-md);margin-bottom:var(--spacing-md);border:1px solid #e2e8f0;box-shadow:0 1px 3px rgba(0,0,0,.06)}
    .ts-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--spacing-sm);flex-wrap:wrap;gap:6px}
    .ts-time-label{font-weight:700;font-size:var(--text-sm);color:var(--premium-gold)}
    .ts-inputs{display:flex;gap:var(--spacing-md);flex-wrap:wrap;margin-bottom:var(--spacing-sm)}
    .ts-inputs .form-group{flex:1;min-width:120px;margin-bottom:0}
    .ts-time-text{font-family:monospace;font-size:1.1rem;letter-spacing:.08em;text-align:center}
    .ts-time-text:focus{border-color:var(--premium-gold)!important;outline:none;box-shadow:0 0 0 3px rgba(249,207,69,.2)}
    .btn-icon-small{padding:4px 10px;background:#e53e3e;color:#fff;border:none;border-radius:var(--radius-sm);cursor:pointer;font-size:12px}
    .member-rate-row{display:flex;align-items:center;gap:8px;margin-bottom:6px;flex-wrap:wrap}
    .member-rate-row select,.member-rate-row input[type=number]{flex:1;min-width:110px;padding:7px 10px;border:1px solid #e2e8f0;border-radius:var(--radius-sm);font-size:var(--text-sm);font-family:inherit}
    .rate-unit{font-size:var(--text-xs);color:var(--premium-text-muted);white-space:nowrap}
    .member-rate-remove{padding:5px 9px;background:#e53e3e;color:#fff;border:none;border-radius:var(--radius-sm);cursor:pointer;flex-shrink:0}
    .empty-state-small{color:var(--premium-text-muted);font-size:var(--text-sm);margin:6px 0}

    #toast{display:none;position:fixed;bottom:24px;right:24px;background:var(--premium-gold);color:#fff;padding:12px 20px;border-radius:var(--radius-md);z-index:9999;box-shadow:0 4px 12px rgba(0,0,0,.25)}
    #toast.show{display:block}

    /* ── Weekly Timetable ──────────────────────────────── */
    .wt-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch}
    .wt-grid{display:flex;min-width:560px;gap:0;position:relative}
    .wt-time-col{width:48px;flex-shrink:0;position:relative}
    .wt-time-col .wt-header{height:36px}
    .wt-time-tick{position:absolute;right:6px;font-size:10px;color:var(--premium-text-muted);transform:translateY(-50%);white-space:nowrap;user-select:none}
    .wt-day-col{flex:1;min-width:72px;position:relative;border-left:1px solid #e2e8f0}
    .wt-day-col:last-child{border-right:1px solid #e2e8f0}
    .wt-header{height:36px;background:linear-gradient(135deg,#1a202c,#2d3748);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#f3f4f6;border-bottom:2px solid var(--premium-gold);position:sticky;top:0;z-index:2}
    .wt-body{position:relative;border-bottom:1px solid #e2e8f0}
    .wt-hour-line{position:absolute;left:0;right:0;border-top:1px dashed #e2e8f0;pointer-events:none}
    .wt-hour-line.full{border-top-style:solid;border-top-color:#cbd5e0}
    .wt-slot{position:absolute;left:2px;right:2px;border-radius:6px;padding:3px 5px;font-size:11px;font-weight:600;overflow:hidden;cursor:default;transition:filter .15s;box-shadow:0 1px 4px rgba(0,0,0,.18);z-index:1}
    .wt-slot:hover{filter:brightness(1.1);z-index:3}
    .wt-slot .wt-slot-name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .wt-slot .wt-slot-time{font-size:9px;opacity:.85;white-space:nowrap}
    .wt-slot.conflict{outline:2px solid #e53e3e;outline-offset:-2px;animation:conflictPulse 1.5s infinite}
    @keyframes conflictPulse{0%,100%{box-shadow:0 0 0 0 rgba(229,62,62,.5)}50%{box-shadow:0 0 0 4px rgba(229,62,62,0)}}
    .wt-conflict-badge{display:inline-block;background:#e53e3e;color:#fff;font-size:10px;font-weight:700;padding:2px 8px;border-radius:12px;margin-left:8px;animation:conflictPulse 1.5s infinite}
    .wt-legend{display:flex;flex-wrap:wrap;gap:8px;margin-top:var(--spacing-md)}
    .wt-legend-item{display:flex;align-items:center;gap:5px;font-size:12px}
    .wt-legend-dot{width:12px;height:12px;border-radius:3px;flex-shrink:0}
    .wt-empty{text-align:center;padding:40px;color:var(--premium-text-muted);font-size:var(--text-sm)}
  </style>
</head>
<body>
  <div id="mainNav"></div>
  <div id="toast"><span class="toast-message"></span></div>
  <main>
    <div class="container">
      <div class="page-header">
        <h1 class="page-title">⚙️ ตั้งค่าวง</h1>
        <button id="saveBtn" class="btn btn-primary">💾 บันทึกทั้งหมด</button>
      </div>

      <!-- Band Info -->
      <div class="card">
        <div class="card-header" style="justify-content:space-between">
          <h3 class="card-title">🎵 ข้อมูลวง</h3>
          <button type="button" class="btn btn-primary btn-sm" onclick="saveBandInfo(this)">💾 บันทึก</button>
        </div>
        <div class="info-grid">
          <div class="form-group"><label>ชื่อวง</label><input type="text" id="bandName" placeholder="ชื่อวงดนตรี"></div>
          <div class="form-group"><label>ผู้จัดการวง</label><input type="text" id="bandManager" placeholder="ชื่อผู้จัดการวง"></div>
        </div>
      </div>

      <!-- Members + Invite Code -->
      <div class="card">
        <div class="card-header" style="justify-content:space-between">
          <h3 class="card-title">👥 สมาชิกวง</h3>
          <div style="display:flex;gap:8px">
            <button id="addMemberBtn" class="btn btn-secondary btn-sm">➕ เพิ่มสมาชิก</button>
            <button type="button" class="btn btn-primary btn-sm" onclick="saveMembers(this)">💾 บันทึก</button>
          </div>
        </div>
        <div id="noMembers" style="display:none"><p class="empty-state-small">ยังไม่มีสมาชิก กดปุ่ม ➕ เพื่อเพิ่ม</p></div>
        <div id="membersList"></div>

        <!-- Invite Code -->
        <div class="invite-box">
          <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;margin-bottom:4px">
            <div>
              <div style="font-weight:700;color:var(--premium-gold);font-size:var(--text-sm)">🔑 รหัสเชิญสมาชิก</div>
              <div style="font-size:var(--text-xs);color:#9ca3af;margin-top:2px">แชร์รหัสนี้ให้สมาชิกใช้ในหน้าสมัครเพื่อเข้าร่วมวงอัตโนมัติ</div>
            </div>
          </div>
          <div id="inviteCodeDisplay" class="invite-code-display empty" title="คลิกเพื่อคัดลอก" onclick="copyInviteCode()">ยังไม่มีรหัสเชิญ</div>
          <div class="invite-expires" id="inviteExpires"></div>
          <div class="invite-actions">
            <button type="button" class="btn btn-sm btn-secondary" id="genInviteBtn" onclick="generateInviteCode()">🎲 สร้างรหัสใหม่</button>
            <button type="button" class="btn btn-sm btn-primary" id="copyInviteBtn" style="display:none" onclick="copyInviteCode()">📋 คัดลอก</button>
          </div>
          <div class="invite-hint">รหัสมีอายุ 7 วัน • สมาชิกกรอกรหัสนี้ในหน้าสมัครเพื่อเข้าร่วมวงทันที</div>
        </div>
      </div>

      <!-- Venues + Schedule (merged) -->
      <div class="card">
        <div class="card-header" style="justify-content:space-between">
          <h3 class="card-title">🏪 ร้านและตารางงาน</h3>
          <div style="display:flex;gap:8px">
            <button id="addVenueBtn" class="btn btn-secondary btn-sm">➕ เพิ่มร้าน</button>
            <button type="button" class="btn btn-primary btn-sm" onclick="saveVenues(this)">💾 บันทึก</button>
          </div>
        </div>
        <p style="font-size:var(--text-xs);color:var(--premium-text-muted);margin-bottom:var(--spacing-md)">① กดเพิ่มร้าน → กด ▶ เพื่อขยายร้าน → ② เลือกวัน → ③ เพิ่มช่วงเวลา → ④ เพิ่มสมาชิกและค่าแรง</p>
        <div id="noVenues" style="display:none"><p class="empty-state-small">ยังไม่มีร้าน กดปุ่ม ➕ เพื่อเพิ่มร้านแรก</p></div>
        <div id="venuesList"></div>
      </div>

      <!-- Weekly Timetable -->
      <div class="card" id="weeklyTimetableCard" style="display:none">
        <div class="card-header">
          <h3 class="card-title">📆 ตารางภาพรวมสัปดาห์ <span id="wtConflictBadge" class="wt-conflict-badge" style="display:none">⚠️ ทับซ้อน</span></h3>
        </div>
        <div class="wt-wrap">
          <div id="weeklyTimetable"></div>
        </div>
        <div id="wtLegend" class="wt-legend"></div>
      </div>

    </div>
  </main>

  <script src="js/i18n.js"></script>
  <script src="js/app.js"></script>
  <script src="js/nav.js"></script>
  <script src="js/band-settings.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      if (typeof requireAuth === 'function') requireAuth();
      if (typeof renderMainNav === 'function') renderMainNav('mainNav');
      if (typeof applyTranslations === 'function') applyTranslations();
    });
  </script>
</body>
</html>
