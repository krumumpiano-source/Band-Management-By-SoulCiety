<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ข้อมูลวงดนตรี — Band Management By SoulCiety</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;700&family=Sarabun:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/theme.css">
  <link rel="stylesheet" href="css/nav.css">
  <link rel="stylesheet" href="css/compat.css">
  <style>
    .member-cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:var(--spacing-lg)}
    .member-card{background:var(--premium-white);border-radius:var(--radius-lg);box-shadow:var(--shadow-sm);padding:var(--spacing-xl);text-align:center;transition:box-shadow .2s;position:relative}
    .member-card:hover{box-shadow:var(--shadow-md)}
    .member-avatar{width:64px;height:64px;border-radius:var(--radius-full);background:var(--premium-gold);color:#fff;display:flex;align-items:center;justify-content:center;font-size:28px;margin:0 auto var(--spacing-md)}
    .member-card h4{font-size:var(--text-base);font-weight:600;margin:0 0 4px}
    .member-card .role-badge{font-size:11px;background:var(--premium-off-white);border-radius:var(--radius-full);padding:2px 10px;color:var(--premium-text-muted);display:inline-block;margin-bottom:var(--spacing-sm)}
    .member-card .contact{font-size:var(--text-xs);color:var(--premium-text-muted)}
    .card-actions{position:absolute;top:8px;right:8px;display:flex;gap:4px;opacity:0;transition:opacity .2s}
    .member-card:hover .card-actions{opacity:1}
    .status-dot{width:8px;height:8px;border-radius:var(--radius-full);display:inline-block;margin-right:4px}
    .status-dot.active{background:#276749}.status-dot.inactive{background:#a0aec0}
  </style>
</head>
<body>
  <div id="mainNav"></div>
  <div id="toast"></div>
  <div id="confirmModal"></div>

  <!-- Member Modal -->
  <div id="memberModal" class="modal-backdrop" style="display:none">
    <div class="modal" style="max-width:520px">
      <div class="modal-header">
        <h3 class="modal-title" id="memberModalTitle">เพิ่มสมาชิก</h3>
        <button class="modal-close" onclick="closeMemberModal()">×</button>
      </div>
      <form id="memberForm">
        <input type="hidden" id="memberId">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-md)">
          <div class="form-group"><label data-i18n="fullName">ชื่อ *</label><input type="text" id="mName" required></div>
          <div class="form-group"><label data-i18n="position">ตำแหน่ง</label><input type="text" id="mPosition" placeholder="กีตาร์, มือกลอง..."></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-md)">
          <div class="form-group"><label data-i18n="phone">เบอร์โทร</label><input type="tel" id="mPhone"></div>
          <div class="form-group"><label data-i18n="email">อีเมล</label><input type="email" id="mEmail"></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-md)">
          <div class="form-group"><label data-i18n="hourlyRate">ค่าตัว/งาน (บาท)</label><input type="number" id="mRate" min="0" value="1500"></div>
          <div class="form-group"><label data-i18n="status">สถานะ</label>
            <select id="mStatus"><option value="active">ใช้งาน</option><option value="inactive">ไม่ใช้งาน</option></select>
          </div>
        </div>
        <div class="form-group"><label data-i18n="notes">หมายเหตุ</label><textarea id="mNotes" rows="2"></textarea></div>
        <div style="display:flex;justify-content:flex-end;gap:var(--spacing-sm)">
          <button type="button" class="btn btn-secondary" onclick="closeMemberModal()" data-i18n="cancel">ยกเลิก</button>
          <button type="button" class="btn btn-danger" id="deleteMemberBtn" style="display:none" onclick="deleteCurrentMember()" data-i18n="delete">ลบ</button>
          <button type="submit" class="btn btn-primary" id="saveMemberBtn" data-i18n="save">บันทึก</button>
        </div>
      </form>
    </div>
  </div>

  <main>
    <div class="container">
      <div class="page-header">
        <h1 class="page-title" data-i18n="nav_bandInfo">ข้อมูลวงดนตรี</h1>
        <button class="btn btn-primary" onclick="openMemberModal(null)">+ <span data-i18n="addMember">เพิ่มสมาชิก</span></button>
      </div>

      <!-- Band Info Summary -->
      <div class="card" style="margin-bottom:var(--spacing-xl)">
        <div class="card-header"><h3 class="card-title" data-i18n="bandDetails">รายละเอียดวง</h3>
          <a href="?page=band-settings" class="btn btn-ghost btn-sm" data-i18n="settings">ตั้งค่า</a>
        </div>
        <div id="bandInfoBox">
          <div style="display:flex;gap:var(--spacing-xl);flex-wrap:wrap;align-items:center">
            <div style="font-size:64px">🎵</div>
            <div>
              <h2 id="bName" style="margin:0;font-size:var(--text-2xl)">—</h2>
              <p id="bGenre" style="color:var(--premium-text-muted);margin:4px 0"></p>
              <p id="bFounded" style="color:var(--premium-text-muted);font-size:var(--text-sm)"></p>
            </div>
          </div>
        </div>
      </div>

      <!-- Members -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title" data-i18n="members">สมาชิกวง</h3>
          <div style="display:flex;gap:var(--spacing-sm)">
            <input type="text" id="memberSearch" placeholder="ค้นหา..." oninput="filterMembers()" style="max-width:200px">
            <select id="statusFilter" onchange="filterMembers()">
              <option value="">ทุกสถานะ</option>
              <option value="active">ใช้งาน</option>
              <option value="inactive">ไม่ใช้งาน</option>
            </select>
          </div>
        </div>
        <div id="memberCards" class="member-cards">
          <div class="empty-state" style="grid-column:1/-1"><p data-i18n="loading">กำลังโหลด...</p></div>
        </div>
      </div>
    </div>
  </main>

  <script src="js/i18n.js"></script>
  <script src="js/app.js"></script>
  <script src="js/nav.js"></script>
  <script src="js/band-members.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', function(){
    requireAuth(); renderMainNav('mainNav'); applyTranslations();
    loadBandInfo(); loadBandMembers();
  });
  function loadBandInfo(){
    gasRun('getBandSettings',{},function(r){
      if(r&&r.data&&r.data.bands&&r.data.bands[0]){
        var b=r.data.bands[0];
        document.getElementById('bName').textContent=b.name||'—';
        document.getElementById('bGenre').textContent=b.genre||'';
        document.getElementById('bFounded').textContent=b.founded?'ก่อตั้ง: '+b.founded:'';
      }
    });
  }
  </script>
</body>
</html>
