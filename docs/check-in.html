<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>ลงเวลาเข้างาน — Band Management By SoulCiety</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;700&family=Sarabun:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/theme.css">
  <link rel="stylesheet" href="css/nav.css">
  <link rel="stylesheet" href="css/compat.css">
  <style>
    .ci-card{max-width:560px;margin:0 auto}
    .ci-member-header{display:flex;align-items:center;gap:var(--spacing-md);padding:var(--spacing-lg);background:linear-gradient(135deg,var(--premium-gold),#b7791f);border-radius:var(--radius-lg);color:#fff;margin-bottom:var(--spacing-xl)}
    .ci-avatar{width:56px;height:56px;background:rgba(255,255,255,.25);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;flex-shrink:0}
    .ci-member-info h2{margin:0;font-size:var(--text-lg,1.1rem);font-weight:700}
    .ci-role-badge{display:inline-block;padding:3px 10px;border-radius:var(--radius-full,999px);background:rgba(255,255,255,.25);font-size:12px;margin-top:4px;font-weight:600}
    .ci-role-badge--admin{background:rgba(229,62,62,.7)}
    .ci-role-badge--manager{background:rgba(49,130,206,.7)}
    .ci-role-badge--member{background:rgba(56,161,89,.5)}

    .ci-form-row{display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-md);margin-bottom:var(--spacing-md)}
    @media(max-width:500px){.ci-form-row{grid-template-columns:1fr}}

    .ci-day-label{font-size:var(--text-sm);color:var(--premium-text-muted);margin-bottom:var(--spacing-sm);font-weight:600}

    .ci-slot-label{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-md) var(--spacing-lg);background:var(--premium-off-white,#f8f8f6);border:2px solid #e2e8f0;border-radius:var(--radius-md);cursor:pointer;margin-bottom:var(--spacing-sm);transition:all .15s;user-select:none}
    .ci-slot-label.checked{border-color:var(--premium-gold);background:#fffbeb}
    .ci-slot-label input[type=checkbox]{accent-color:var(--premium-gold);width:18px;height:18px;flex-shrink:0}
    .ci-slot-time{font-weight:600;font-size:var(--text-base)}
    .ci-slot-shortcuts{display:flex;gap:var(--spacing-sm);margin-bottom:var(--spacing-md)}
    .btn-xs{padding:4px 12px;font-size:12px;border-radius:var(--radius-sm);border:1px solid var(--premium-border,#ccc);background:none;cursor:pointer;color:var(--premium-text-muted)}
    .btn-xs:hover{background:var(--premium-off-white)}

    .ci-status{padding:var(--spacing-sm) var(--spacing-md);border-radius:var(--radius-md);font-size:var(--text-sm);font-weight:600;margin-top:var(--spacing-md);display:none}
    .ci-status--success{background:#d4edda;color:#155724;display:block}
    .ci-status--error{background:#f8d7da;color:#721c24;display:block}
    .ci-status--info{background:#d1ecf1;color:#0c5460;display:block}

    .ci-no-slots{color:var(--premium-text-muted);font-size:var(--text-sm);padding:var(--spacing-md) 0;display:none}

    .ci-submit-btn{width:100%;padding:14px;font-size:var(--text-base,1rem);font-weight:700;margin-top:var(--spacing-lg)}
    .ci-manager-link{margin-top:var(--spacing-lg);text-align:center;font-size:var(--text-sm)}
    .ci-manager-link a{color:var(--premium-gold);font-weight:600;text-decoration:none}
    .ci-manager-link a:hover{text-decoration:underline}
    /* Substitute toggle */
    .ci-sub-toggle{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-sm) 0;margin-bottom:var(--spacing-sm)}
    .ci-sub-toggle input[type=checkbox]{accent-color:var(--premium-gold);width:18px;height:18px}
    .ci-sub-toggle label{font-weight:600;font-size:var(--text-sm);cursor:pointer;user-select:none}
    .ci-sub-fields{display:none;padding:var(--spacing-md);background:#fffbeb;border:1px dashed var(--premium-gold);border-radius:var(--radius-md);margin-bottom:var(--spacing-md)}
    .ci-sub-fields.active{display:block}
    .ci-sub-fields .form-group{margin-bottom:var(--spacing-sm)}
    .ci-sub-fields .form-group:last-child{margin-bottom:0}
    .ci-sub-name-chip{display:inline-flex;align-items:center;gap:4px;background:var(--premium-gold);color:#fff;padding:3px 10px;border-radius:var(--radius-full,999px);font-size:12px;font-weight:600;margin-top:4px}
    #toast{display:none;position:fixed;bottom:24px;right:24px;color:#fff;padding:12px 20px;border-radius:var(--radius-md);z-index:9999;box-shadow:0 4px 12px rgba(0,0,0,.25);background:var(--premium-gold)}
    #toast.show{display:block}

    /* Leave button */
    .ci-btn-row{display:flex;gap:var(--spacing-md);margin-top:var(--spacing-lg);flex-wrap:wrap}
    .ci-submit-btn{flex:1;margin-top:0}
    .ci-leave-btn{flex:0 0 auto;padding:14px 24px;font-size:var(--text-base,1rem);font-weight:700;border-radius:var(--radius-md);border:2px solid #e53e3e;background:#fff;color:#e53e3e;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:8px;justify-content:center}
    .ci-leave-btn:hover{background:#e53e3e;color:#fff}
    /* Leave inline form */
    .ci-leave-form{display:none;background:linear-gradient(135deg,#fff5f5,#fed7d7);border:2px solid #feb2b2;border-radius:var(--radius-lg);padding:var(--spacing-lg);margin-top:var(--spacing-md);animation:ciLeaveIn .2s ease}
    .ci-leave-form.show{display:block}
    @keyframes ciLeaveIn{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:none}}
    .ci-leave-form h4{margin:0 0 8px;font-size:var(--text-md);font-weight:700;color:#c53030}
    .ci-leave-form p{margin:0 0 12px;font-size:var(--text-sm);color:var(--premium-text-muted)}
    .ci-leave-form input{width:100%;box-sizing:border-box;padding:12px 14px;border:2px solid #feb2b2;border-radius:var(--radius-md);font-size:var(--text-base);font-family:var(--font-family-body);transition:border-color .2s}
    .ci-leave-form input:focus{outline:none;border-color:#e53e3e}
    .ci-leave-actions{display:flex;gap:8px;margin-top:12px}
    .ci-leave-actions .btn-leave-ok{padding:10px 24px;border:none;background:#e53e3e;color:#fff;border-radius:var(--radius-md);cursor:pointer;font-size:var(--text-sm);font-weight:700;font-family:var(--font-family-body);transition:background .2s}
    .ci-leave-actions .btn-leave-ok:hover{background:#c53030}
    .ci-leave-actions .btn-leave-cancel{padding:10px 24px;border:1px solid #ccc;background:#fff;border-radius:var(--radius-md);cursor:pointer;font-size:var(--text-sm);font-family:var(--font-family-body)}
  </style>
</head>
<body>
  <div id="mainNav"></div>
  <div id="toast"><span class="toast-message"></span></div>

  <main>
    <div class="container">
      <div class="ci-card">
        <!-- Member Header -->
        <div class="ci-member-header">
          <div class="ci-avatar">🎵</div>
          <div class="ci-member-info">
            <h2>สวัสดี, <span id="ciMemberName">สมาชิก</span></h2>
            <span id="ciRoleBadge" class="ci-role-badge">สมาชิก</span>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">⏰ ลงเวลาเข้างาน</h3>
          </div>

          <!-- Date & Venue -->
          <div class="ci-form-row">
            <div class="form-group">
              <label>📅 วันที่</label>
              <input type="date" id="ciDate">
            </div>
            <div class="form-group">
              <label>🏪 สถานที่</label>
              <select id="ciVenue"></select>
            </div>
          </div>

          <!-- Status (existing check-in) -->
          <div id="ciStatus" class="ci-status"></div>

          <!-- Time Slots -->
          <div class="form-group" style="margin-top:var(--spacing-md)">
            <label>🕐 ช่วงเวลาที่ทำงาน</label>
            <div id="ciDayLabel" class="ci-day-label"></div>
            <div class="ci-slot-shortcuts">
              <button type="button" class="btn-xs" id="ciSelectAll">เลือกทั้งหมด</button>
              <button type="button" class="btn-xs" id="ciSelectNone">ล้างทั้งหมด</button>
            </div>
            <div id="ciSlotsContainer"></div>
            <div id="ciNoSlots" class="ci-no-slots">เลือกวันที่และสถานที่ก่อนเพื่อดูช่วงเวลา</div>
          </div>

          <!-- Substitute Option -->
          <div style="margin-top:var(--spacing-md)">
            <div class="ci-sub-toggle">
              <input type="checkbox" id="ciSubToggle">
              <label for="ciSubToggle">🔄 ลงเวลาแทนคนอื่น (คนแทน)</label>
            </div>
            <div id="ciSubFields" class="ci-sub-fields">
              <p style="font-size:12px;color:var(--premium-text-muted);margin:0 0 8px">ระบุชื่อคนที่มาทำงานแทน — ระบบจะบันทึกว่าเป็นการลงเวลาแทน</p>
              <div class="form-group">
                <label>👤 ชื่อคนแทน</label>
                <input type="text" id="ciSubName" placeholder="เช่น สมชาย, คุณแม็ค...">
              </div>
              <div class="form-group">
                <label>📱 เบอร์โทร / ติดต่อ (ไม่บังคับ)</label>
                <input type="text" id="ciSubContact" placeholder="08x-xxx-xxxx">
              </div>
            </div>
          </div>

          <!-- Notes -->
          <div class="form-group">
            <label>📝 หมายเหตุ (ถ้ามี)</label>
            <textarea id="ciNotes" rows="2" placeholder="เช่น มาสาย 15 นาที, ลาก่อนช่วงสุดท้าย..."></textarea>
          </div>

          <!-- Submit Row -->
          <div class="ci-btn-row">
            <button id="ciSubmitBtn" class="btn btn-primary ci-submit-btn">✅ บันทึกเวลาเข้างาน</button>
            <button type="button" id="ciLeaveBtn" class="ci-leave-btn">🚫 ลา</button>
          </div>

          <!-- Leave inline form -->
          <div class="ci-leave-form" id="ciLeaveForm">
            <h4>🚫 ลางาน</h4>
            <p>กรอกชื่อคนมาทำงานแทน หรือเลือก "ไม่มีคนแทน"</p>
            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;margin-bottom:10px;font-size:var(--text-sm);font-weight:600;user-select:none">
              <input type="checkbox" id="ciLeaveNoSub" style="accent-color:#e53e3e;width:18px;height:18px"> ไม่มีคนแทน
            </label>
            <input type="text" id="ciLeaveSubNameSimple" placeholder="ชื่อคนแทน เช่น สมชาย, คุณแพท...">
            <div class="ci-leave-actions">
              <button type="button" class="btn-leave-ok" id="ciLeaveSubmitSimple">✅ ยืนยันลา</button>
              <button type="button" class="btn-leave-cancel" id="ciLeaveCancelSimple">ยกเลิก</button>
            </div>
          </div>
        </div>

        <!-- Manager quick link (shown for manager/admin) -->
        <div id="ciManagerLink" class="ci-manager-link" style="display:none">
          <a href="attendance-payroll.html">📋 ไปหน้าเบิกจ่าย (ดูการลงเวลาของสมาชิกทั้งหมด)</a>
        </div>
        <!-- Leave management link -->
        <div class="ci-manager-link" style="margin-top:var(--spacing-md)">
          <a href="leave.html">🔄 ไปหน้าคนลาคนแทน (จัดการใบลาทั้งหมด)</a>
        </div>
      </div>
    </div>
  </main>

  <script src="js/i18n.js"></script>
  <script src="js/app.js"></script>
  <script src="js/nav.js"></script>
  <script src="js/check-in.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      if (typeof requireAuth === 'function') requireAuth();
      if (typeof renderMainNav === 'function') renderMainNav('mainNav');
      if (typeof applyTranslations === 'function') applyTranslations();
      // Show manager link for manager/admin
      var role = localStorage.getItem('userRole');
      if (role === 'manager' || role === 'admin') {
        var el = document.getElementById('ciManagerLink');
        if (el) el.style.display = 'block';
      }
    });
  </script>
</body>
</html>
