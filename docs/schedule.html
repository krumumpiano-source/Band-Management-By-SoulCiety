<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>ตารางงาน — Band Management By SoulCiety</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;700&family=Sarabun:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/theme.css">
  <link rel="stylesheet" href="css/nav.css">
  <link rel="stylesheet" href="css/compat.css">
  <style>
    .filter-card{margin-bottom:var(--spacing-lg)}
    .filter-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:var(--spacing-md);align-items:flex-end}
    .summary-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:var(--spacing-md);margin-bottom:var(--spacing-lg)}
    @media(max-width:640px){.summary-stats{grid-template-columns:repeat(2,1fr)}}
    .stat-card{background:var(--premium-off-white);border-radius:var(--radius-md);padding:var(--spacing-md);text-align:center}
    .stat-value{font-size:var(--text-xl,1.5rem);font-weight:700;color:var(--premium-gold)}
    .stat-label{font-size:var(--text-xs,12px);color:var(--premium-text-muted);margin-top:4px}
    .gig-type-badge{display:inline-block;padding:2px 8px;border-radius:var(--radius-full,999px);font-size:12px;font-weight:600}
    .gig-type-badge.regular{background:#d4edda;color:#155724}
    .gig-type-badge.external{background:#fff3cd;color:#856404}
    .btn-icon-tiny{padding:3px 8px;border:none;border-radius:4px;cursor:pointer;font-size:12px}
    .btn-icon-tiny.edit{background:#e2e8f0;color:#333}
    .btn-icon-tiny.delete{background:#fed7d7;color:#c53030}
    .btn-icon-tiny.payout{background:#c6f6d5;color:#276749}
    .gig-actions-cell{white-space:nowrap;display:flex;gap:4px;align-items:center}
    .modal-backdrop{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:1000;align-items:center;justify-content:center}
    .modal-backdrop[style*="flex"]{display:flex !important}
    .modal-box{background:var(--premium-white,#fff);border-radius:var(--radius-lg);padding:var(--spacing-xl);max-width:540px;width:90%;max-height:90vh;overflow-y:auto}
    .modal-header-inner{display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--spacing-lg)}
    .modal-close-btn{background:none;border:none;font-size:24px;cursor:pointer;color:var(--premium-text-muted)}
    .member-checkbox-item{display:flex;align-items:center;gap:var(--spacing-sm);margin-bottom:var(--spacing-xs,4px)}
    #memberFilterGroup{display:none}
    #noScheduleData{display:none;text-align:center;padding:var(--spacing-xl);color:var(--premium-text-muted)}
    #toast{display:none;position:fixed;bottom:24px;right:24px;background:var(--premium-gold);color:#fff;padding:12px 20px;border-radius:var(--radius-md);z-index:9999;box-shadow:0 4px 12px rgba(0,0,0,.25)}
    #toast.show{display:block}
    /* Weekly Timetable */
    .wt-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px}
    @media(max-width:768px){.wt-grid{grid-template-columns:1fr}}
    .wt-day{background:var(--premium-off-white);border-radius:var(--radius-md);padding:10px;min-height:80px}
    .wt-day.wt-today{border:2px solid var(--premium-gold);background:#fffbeb}
    .wt-day.wt-off{opacity:.5}
    .wt-day-name{font-weight:700;font-size:var(--text-sm);margin-bottom:8px;color:var(--premium-text)}
    .wt-badge-today{background:var(--premium-gold);color:#fff;font-size:10px;padding:1px 6px;border-radius:var(--radius-full,999px);font-weight:600;margin-left:4px}
    .wt-slot{background:var(--premium-white);border-radius:var(--radius-sm,4px);padding:6px 8px;margin-bottom:4px;font-size:var(--text-xs,12px);border-left:3px solid var(--premium-gold)}
    .wt-time{display:block;font-weight:600;color:var(--premium-text)}
    .wt-venue{display:block;color:var(--premium-text-light)}
    .wt-members{display:block;color:var(--premium-text-muted);font-size:11px}
    .wt-off-text{color:var(--premium-text-muted);font-size:var(--text-xs,12px);font-style:italic}
  </style>
</head>
<body>
  <div id="mainNav"></div>
  <div id="toast"><span class="toast-message"></span></div>

  <!-- Add External Gig Modal -->
  <div id="addExternalGigModal" class="modal-backdrop">
    <div class="modal-box">
      <div class="modal-header-inner">
        <h3>➕ เพิ่มงานนอก</h3>
        <button class="modal-close-btn" id="closeModalBtn">×</button>
      </div>
      <form id="externalGigForm">
        <div class="form-group"><label>วันที่ *</label><input type="date" id="gigDate" required></div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-md)">
          <div class="form-group"><label>เวลาเริ่ม *</label><input type="time" id="gigStartTime" required></div>
          <div class="form-group"><label>เวลาจบ *</label><input type="time" id="gigEndTime" required></div>
        </div>
        <div class="form-group"><label>สถานที่ *</label><input type="text" id="gigVenue" placeholder="ชื่อสถานที่" required></div>
        <div class="form-group"><label>ที่อยู่</label><input type="text" id="gigAddress" placeholder="ที่อยู่สถานที่"></div>
        <div class="form-group"><label>ค่าตัว (บาท) *</label><input type="number" id="gigPrice" min="0" required></div>
        <div class="form-group"><label>รายละเอียด</label><textarea id="gigDescription" rows="2" placeholder="รายละเอียดงาน"></textarea></div>
        <div class="form-group"><label>ติดต่อ</label><input type="text" id="gigContact" placeholder="เบอร์โทรหรือช่องทางติดต่อ"></div>
        <div class="form-group"><label>สมาชิกที่ร่วมงาน</label><div id="gigMembersList" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:4px;margin-top:8px"></div></div>
        <div style="display:flex;justify-content:flex-end;gap:var(--spacing-sm);margin-top:var(--spacing-md)">
          <button type="button" class="btn btn-secondary" id="cancelGigBtn">ยกเลิก</button>
          <button type="submit" class="btn btn-primary">💾 บันทึกงาน</button>
        </div>
      </form>
    </div>
  </div>

  <main>
    <div class="container">
      <div class="page-header">
        <h1 class="page-title">📅 <span data-i18n="nav_schedule">ตารางงาน</span></h1>
        <button id="addExternalGigBtn" class="btn btn-primary">➕ เพิ่มงานนอก</button>
      </div>

      <!-- Weekly Timetable from Band Settings -->
      <div class="card" style="margin-bottom:var(--spacing-xl)" id="weeklyTimetableCard">
        <div class="card-header">
          <h3 class="card-title">📅 ตารางงานสัปดาห์</h3>
        </div>
        <div id="weeklyTimetable" class="wt-grid" style="padding:var(--spacing-md)">
          <span style="color:var(--premium-text-muted);font-size:var(--text-sm)">⏳ กำลังโหลด...</span>
        </div>
      </div>

      <!-- Summary Stats -->
      <div class="summary-stats">
        <div class="stat-card"><div class="stat-value" id="totalGigs">0</div><div class="stat-label">งานทั้งหมด</div></div>
        <div class="stat-card"><div class="stat-value" id="regularGigs">0</div><div class="stat-label">งานปกติ</div></div>
        <div class="stat-card"><div class="stat-value" id="externalGigs">0</div><div class="stat-label">งานนอก</div></div>
        <div class="stat-card"><div class="stat-value" id="totalRevenue">0</div><div class="stat-label">รายได้รวม</div></div>
      </div>

      <!-- Filters -->
      <div class="card filter-card">
        <div class="card-header"><h3 class="card-title">🔍 ค้นหาและกรอง</h3></div>
        <div class="filter-grid">
          <div class="form-group">
            <label>ประเภทการดู</label>
            <select id="viewType"><option value="all">ทั้งวง</option><option value="individual">รายคน</option></select>
          </div>
          <div class="form-group" id="memberFilterGroup">
            <label>สมาชิก</label>
            <select id="memberFilter"><option value="">เลือกสมาชิก</option></select>
          </div>
          <div class="form-group">
            <label>ช่วงเวลา</label>
            <select id="periodType">
              <option value="daily">รายวัน</option>
              <option value="weekly">รายสัปดาห์</option>
              <option value="history">ย้อนหลัง</option>
            </select>
          </div>
          <div class="form-group" id="dateFilterGroup">
            <label>วันที่</label>
            <input type="date" id="dateFilter">
          </div>
          <div class="form-group" id="weekFilterGroup" style="display:none">
            <label>สัปดาห์</label>
            <input type="week" id="weekFilter">
          </div>
          <div id="historyDateGroup" style="display:none;grid-column:span 2">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-md)">
              <div class="form-group"><label>วันที่เริ่ม</label><input type="date" id="historyStartDate"></div>
              <div class="form-group"><label>วันที่สิ้นสุด</label><input type="date" id="historyEndDate"></div>
            </div>
          </div>
          <div class="form-group" style="display:flex;align-items:flex-end">
            <button id="applyFiltersBtn" class="btn btn-primary" style="width:100%">🔍 ค้นหา</button>
          </div>
        </div>
      </div>

      <!-- Schedule Table -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title" id="scheduleTableTitle">📋 ตารางงาน</h3>
        </div>
        <div id="noScheduleData">
          <p>ไม่พบข้อมูลตารางงาน<br>กรองวันที่หรือเพิ่มงานนอกให้เรียบร้อย</p>
        </div>
        <div class="table-responsive">
          <table class="table" style="min-width:700px">
            <thead id="scheduleTableHead"></thead>
            <tbody id="scheduleTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </main>

  <script src="js/i18n.js"></script>
  <script src="js/app.js"></script>
  <script src="js/nav.js"></script>
  <script src="js/schedule.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      if (typeof requireAuth === 'function') requireAuth();
      if (typeof renderMainNav === 'function') renderMainNav('mainNav');
      if (typeof applyTranslations === 'function') applyTranslations();
    });
  </script>
</body>
</html>
