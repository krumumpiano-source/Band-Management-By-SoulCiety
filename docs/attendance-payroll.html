<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>????????????? — Band Management By SoulCiety</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;700&family=Sarabun:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/theme.css">
  <link rel="stylesheet" href="css/nav.css">
  <link rel="stylesheet" href="css/compat.css">
  <style>
    .attendance-table th,.attendance-table td{padding:6px 10px;border:1px solid var(--premium-border,#e2e8f0);font-size:13px;white-space:nowrap}
    .attendance-table th{background:var(--premium-off-white,#f8f8f6);font-weight:600}
    .attendance-table td.sticky-col{position:sticky;left:0;background:var(--premium-white,#fff);z-index:1;min-width:120px}
    .payout-table th,.payout-table td{padding:6px 10px;border:1px solid var(--premium-border,#e2e8f0);font-size:13px}
    .payout-table th{background:var(--premium-off-white,#f8f8f6);font-weight:600}
    .section-divider{margin:var(--spacing-xl) 0;border:none;border-top:2px solid var(--premium-border,#e2e8f0)}
    .band-info-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:var(--spacing-md);margin-bottom:var(--spacing-lg)}
    @media(max-width:640px){.band-info-grid{grid-template-columns:1fr}}
    .info-item{background:var(--premium-off-white,#f8f9fa);border-radius:var(--radius-md);padding:var(--spacing-sm) var(--spacing-md)}
    .info-label{font-size:12px;color:var(--premium-text-muted);margin-bottom:2px}
    .info-value{font-weight:600}
    .filter-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:var(--spacing-md);align-items:flex-end}
    #toast{display:none;position:fixed;bottom:24px;right:24px;background:var(--premium-gold);color:#fff;padding:12px 20px;border-radius:var(--radius-md);z-index:9999;box-shadow:0 4px 12px rgba(0,0,0,.25)}
    #toast.show{display:block}
    #dailyDateGroup,#weeklyDateGroup,#monthlyDateGroup{display:none}
    #bandInfoCard{display:none}
    .action-btns{display:flex;flex-wrap:wrap;gap:var(--spacing-sm);margin-top:var(--spacing-md)}
    input[type=number].payout-input{width:80px;text-align:right;border:1px solid var(--premium-border,#ccc);border-radius:4px;padding:2px 6px;font-size:13px}
    input[type=number].payout-input:focus{outline:2px solid var(--premium-gold)}
    .total-row td{font-weight:700;background:var(--premium-off-white);color:var(--premium-gold)}
  </style>
</head>
<body>
  <div id="mainNav"></div>
  <div id="toast"><span class="toast-message"></span></div>

  <main>
    <div class="container">
      <div class="page-header">
        <h1 class="page-title">?? <span data-i18n="nav_attendance">?????????????</span></h1>
      </div>

      <!-- Filter Form -->
      <div class="card" style="margin-bottom:var(--spacing-lg)">
        <div class="card-header"><h3 class="card-title">?? ????????????????</h3></div>
        <div class="filter-grid">
          <div class="form-group">
            <label>???????????????</label>
            <select id="recordType">
              <option value="daily">??????</option>
              <option value="weekly">??????????</option>
              <option value="monthly">????????</option>
            </select>
          </div>
          <div class="form-group" id="dailyDateGroup">
            <label>???????????</label>
            <input type="date" id="workDate">
          </div>
          <div class="form-group" id="weeklyDateGroup">
            <label>???????????</label>
            <input type="date" id="startDate">
          </div>
          <div class="form-group" id="weeklyDateGroup2" style="display:none">
            <label>?????????????</label>
            <input type="date" id="endDate">
          </div>
          <div class="form-group" id="monthlyDateGroup">
            <label>?????/??</label>
            <input type="month" id="monthYear">
          </div>
          <div class="form-group">
            <label>??????? (Venue)</label>
            <select id="venue"><option value="">-- ???????????? --</option></select>
          </div>
          <div class="form-group" style="display:flex;align-items:flex-end">
            <button id="apLoadBtn" class="btn btn-primary" style="width:100%">?? ?????????</button>
          </div>
        </div>
      </div>

      <!-- Band Info Card -->
      <div id="bandInfoCard" class="card" style="margin-bottom:var(--spacing-lg)">
        <div class="card-header"><h3 class="card-title">?? ????????</h3></div>
        <div class="band-info-grid">
          <div class="info-item"><div class="info-label">??????</div><div class="info-value" id="bandNameDisplay">-</div></div>
          <div class="info-item"><div class="info-label">?????????</div><div class="info-value" id="bandManagerDisplay">-</div></div>
          <div class="info-item"><div class="info-label">???????????</div><div class="info-value" id="memberCountDisplay">-</div></div>
        </div>
      </div>

      <!-- Attendance Table -->
      <div class="card" style="margin-bottom:var(--spacing-lg)">
        <div class="card-header">
          <h3 class="card-title" id="attendanceTableTitle">?? ????????????</h3>
        </div>
        <div class="table-responsive">
          <table class="table attendance-table" style="min-width:600px">
            <thead id="attendanceTableHead"></thead>
            <tbody id="attendanceTableBody">
              <tr><td colspan="10" style="text-align:center;color:var(--premium-text-muted);padding:2rem">??????????????????????????? "?????????"</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Payout Table -->
      <div class="card" style="margin-bottom:var(--spacing-lg)">
        <div class="card-header"><h3 class="card-title">?? ?????????????</h3></div>
        <div class="table-responsive">
          <table class="table payout-table" style="min-width:500px">
            <thead id="payoutTableHead"></thead>
            <tbody id="payoutTableBody">
              <tr><td colspan="10" style="text-align:center;color:var(--premium-text-muted);padding:2rem">??????????????????????????</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-btns">
        <button id="saveBtn" class="btn btn-primary">?? ????????????</button>
        <button id="generateVenueReceiptBtn" class="btn btn-secondary">?? ????? (???????)</button>
        <button id="generateMemberReceiptBtn" class="btn btn-secondary">?? ????? (??????)</button>
      </div>
    </div>
  </main>

  <script src="js/i18n.js"></script>
  <script src="js/app.js"></script>
  <script src="js/nav.js"></script>
  <script src="js/attendance-payroll.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      if (typeof requireAuth === 'function') requireAuth();
      if (typeof renderMainNav === 'function') renderMainNav('mainNav');
      if (typeof applyTranslations === 'function') applyTranslations();

      // Record type toggle
      var rt = document.getElementById('recordType');
      function showDateGroup() {
        ['dailyDateGroup','weeklyDateGroup','weeklyDateGroup2','monthlyDateGroup'].forEach(function(id) {
          var el = document.getElementById(id);
          if (el) el.style.display = 'none';
        });
        var v = rt ? rt.value : 'daily';
        if (v === 'daily') {
          var d = document.getElementById('dailyDateGroup');
          if (d) d.style.display = 'block';
        } else if (v === 'weekly') {
          ['weeklyDateGroup','weeklyDateGroup2'].forEach(function(id) {
            var el = document.getElementById(id);
            if (el) el.style.display = 'block';
          });
        } else if (v === 'monthly') {
          var m = document.getElementById('monthlyDateGroup');
          if (m) m.style.display = 'block';
        }
      }
      if (rt) { rt.addEventListener('change', showDateGroup); showDateGroup(); }

      // Load button delegation (calls attendance-payroll.js main logic)
      var loadBtn = document.getElementById('apLoadBtn');
      if (loadBtn) {
        loadBtn.addEventListener('click', function() {
          if (typeof apLoadBandData === 'function') { apLoadBandData(); }
        });
      }
      if (typeof apInitPage === 'function') apInitPage();
    });
  </script>
</body>
</html>