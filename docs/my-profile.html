<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§ â€” Band Management By SoulCiety</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;700&family=Sarabun:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/theme.css">
  <link rel="stylesheet" href="css/nav.css">
  <link rel="stylesheet" href="css/compat.css">
  <style>
    .profile-avatar-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-xl);
    }
    .profile-avatar {
      width: 90px; height: 90px;
      background: var(--premium-gold);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 2.5rem;
      box-shadow: var(--shadow-lg);
    }
    .profile-name-display {
      text-align: center;
    }
    .profile-name-display .full-name {
      font-size: var(--text-xl);
      font-weight: 700;
      color: var(--premium-text);
    }
    .profile-name-display .nickname {
      font-size: var(--text-base);
      color: var(--premium-text-muted);
    }
    .profile-name-display .instrument {
      font-size: var(--text-sm);
      color: var(--premium-gold);
      font-weight: 600;
    }
    .form-section-label {
      font-size: var(--text-xs);
      font-weight: 600;
      color: var(--premium-text-muted);
      text-transform: uppercase;
      letter-spacing: .05em;
      margin: var(--spacing-lg) 0 var(--spacing-xs);
      border-bottom: 1px solid var(--premium-light-gray);
      padding-bottom: 4px;
    }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md); }
    .form-row-3 { display: grid; grid-template-columns: auto 1fr 1fr; gap: var(--spacing-md); }
    @media(max-width:576px) { .form-row, .form-row-3 { grid-template-columns: 1fr; } }
    .info-readonly {
      background: var(--premium-light-gray);
      border-radius: var(--radius-md);
      padding: var(--spacing-sm) var(--spacing-md);
      font-size: var(--text-sm);
      color: var(--premium-text-muted);
    }
  </style>
</head>
<body>
  <div id="mainNav"></div>
  <div id="toast"></div>
  <main>
    <div class="container" style="max-width:640px">
      <div class="page-header">
        <h1 class="page-title">ğŸ‘¤ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§</h1>
      </div>

      <!-- Avatar + à¸Šà¸·à¹ˆà¸­à¹à¸ªà¸”à¸‡à¸œà¸¥ -->
      <div class="card" style="margin-bottom:var(--spacing-lg)">
        <div class="profile-avatar-wrap">
          <div class="profile-avatar" id="avatarIcon">ğŸ¤</div>
          <div class="profile-name-display">
            <div class="full-name" id="displayFullName">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”...</div>
            <div class="nickname" id="displayNickname"></div>
            <div class="instrument" id="displayInstrument"></div>
          </div>
        </div>
      </div>

      <!-- à¸Ÿà¸­à¸£à¹Œà¸¡à¹à¸à¹‰à¹„à¸‚ -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">à¹à¸à¹‰à¹„à¸‚à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§</h3>
        </div>

        <form id="profileForm">
          <!-- à¸„à¸³à¸™à¸³à¸«à¸™à¹‰à¸² + à¸Šà¸·à¹ˆà¸­ + à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥ -->
          <div class="form-section-label">à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§</div>
          <div class="form-row-3">
            <div class="form-group">
              <label>à¸„à¸³à¸™à¸³à¸«à¸™à¹‰à¸²</label>
              <select id="title" class="form-control">
                <option value="à¸™à¸²à¸¢">à¸™à¸²à¸¢</option>
                <option value="à¸™à¸²à¸‡">à¸™à¸²à¸‡</option>
                <option value="à¸™à¸²à¸‡à¸ªà¸²à¸§">à¸™à¸²à¸‡à¸ªà¸²à¸§</option>
                <option value="à¸”.à¸Š.">à¸”.à¸Š.</option>
                <option value="à¸”.à¸.">à¸”.à¸.</option>
                <option value="à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸">à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸</option>
              </select>
            </div>
            <div class="form-group">
              <label>à¸Šà¸·à¹ˆà¸­ <span style="color:#c53030">*</span></label>
              <input type="text" id="firstName" class="form-control" placeholder="à¸Šà¸·à¹ˆà¸­à¸ˆà¸£à¸´à¸‡" required>
            </div>
            <div class="form-group">
              <label>à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥ <span style="color:#c53030">*</span></label>
              <input type="text" id="lastName" class="form-control" placeholder="à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>à¸Šà¸·à¹ˆà¸­à¹€à¸¥à¹ˆà¸™ <span style="color:#c53030">*</span></label>
              <input type="text" id="nickname" class="form-control" placeholder="à¸Šà¸·à¹ˆà¸­à¹€à¸¥à¹ˆà¸™" required>
              <small style="color:var(--premium-text-muted)">à¸Šà¸·à¹ˆà¸­à¸—à¸µà¹ˆà¹à¸ªà¸”à¸‡à¹ƒà¸™à¸£à¸°à¸šà¸š</small>
            </div>
            <div class="form-group">
              <label>à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡ / à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸”à¸™à¸•à¸£à¸µ</label>
              <select id="instrument" class="form-control">
                <option value="">-- à¹€à¸¥à¸·à¸­à¸ --</option>
                <option value="à¸£à¹‰à¸­à¸‡à¸™à¸³">ğŸ¤ à¸£à¹‰à¸­à¸‡à¸™à¸³</option>
                <option value="à¸£à¹‰à¸­à¸‡à¸›à¸£à¸°à¸ªà¸²à¸™">ğŸ¤ à¸£à¹‰à¸­à¸‡à¸›à¸£à¸°à¸ªà¸²à¸™</option>
                <option value="à¸à¸µà¸•à¸²à¸£à¹Œà¹„à¸Ÿà¸Ÿà¹‰à¸²">ğŸ¸ à¸à¸µà¸•à¸²à¸£à¹Œà¹„à¸Ÿà¸Ÿà¹‰à¸²</option>
                <option value="à¸à¸µà¸•à¸²à¸£à¹Œà¹‚à¸›à¸£à¹ˆà¸‡">ğŸ¸ à¸à¸µà¸•à¸²à¸£à¹Œà¹‚à¸›à¸£à¹ˆà¸‡</option>
                <option value="à¸à¸µà¸•à¸²à¸£à¹Œà¹€à¸šà¸ª">ğŸ¸ à¸à¸µà¸•à¸²à¸£à¹Œà¹€à¸šà¸ª</option>
                <option value="à¸„à¸µà¸¢à¹Œà¸šà¸­à¸£à¹Œà¸”">ğŸ¹ à¸„à¸µà¸¢à¹Œà¸šà¸­à¸£à¹Œà¸”</option>
                <option value="à¸à¸¥à¸­à¸‡">ğŸ¥ à¸à¸¥à¸­à¸‡</option>
                <option value="à¹€à¸à¸­à¸£à¹Œà¸„à¸±à¸ªà¸Šà¸±à¸™">ğŸ¥ à¹€à¸à¸­à¸£à¹Œà¸„à¸±à¸ªà¸Šà¸±à¸™</option>
                <option value="à¸—à¸£à¸±à¸¡à¹€à¸›à¸•">ğŸº à¸—à¸£à¸±à¸¡à¹€à¸›à¸•</option>
                <option value="à¹à¸‹à¸à¹‚à¸‹à¹‚à¸Ÿà¸™">ğŸ· à¹à¸‹à¸à¹‚à¸‹à¹‚à¸Ÿà¸™</option>
                <option value="à¹„à¸§à¹‚à¸­à¸¥à¸´à¸™">ğŸ» à¹„à¸§à¹‚à¸­à¸¥à¸´à¸™</option>
                <option value="à¸œà¸¹à¹‰à¸ˆà¸±à¸”à¸à¸²à¸£à¸§à¸‡">ğŸ“‹ à¸œà¸¹à¹‰à¸ˆà¸±à¸”à¸à¸²à¸£à¸§à¸‡</option>
                <option value="à¸­à¸·à¹ˆà¸™à¹†">à¸­à¸·à¹ˆà¸™à¹†</option>
              </select>
            </div>
          </div>

          <!-- à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ read-only -->
          <div class="form-row">
            <div class="form-group">
              <label>à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸¨à¸±à¸à¸—à¹Œ</label>
              <input type="tel" id="phone" class="form-control" placeholder="0xx-xxx-xxxx">
              <small style="color:var(--premium-text-muted)">à¹ƒà¸Šà¹‰à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸¹à¹‰à¸„à¸·à¸™à¸šà¸±à¸à¸Šà¸µà¸à¸£à¸“à¸µà¸¥à¸·à¸¡à¸­à¸µà¹€à¸¡à¸¥</small>
            </div>
          </div>

          <div class="form-section-label">à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸šà¸±à¸à¸Šà¸µ (à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹à¸à¹‰à¹„à¸‚)</div>
          <div class="form-row">
            <div class="form-group">
              <label>à¸­à¸µà¹€à¸¡à¸¥</label>
              <div class="info-readonly" id="profileEmail">â€”</div>
            </div>
            <div class="form-group">
              <label>à¸§à¸‡</label>
              <div class="info-readonly" id="profileBand">â€”</div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>à¸šà¸—à¸šà¸²à¸—</label>
              <div class="info-readonly" id="profileRole">â€”</div>
            </div>
            <div class="form-group">
              <label>à¸ªà¸–à¸²à¸™à¸°</label>
              <div class="info-readonly" id="profileStatus">â€”</div>
            </div>
          </div>

          <div style="margin-top:var(--spacing-xl);display:flex;gap:var(--spacing-md);flex-wrap:wrap">
            <button type="submit" class="btn btn-primary" id="saveBtn">
              ğŸ’¾ à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
            </button>
            <button type="button" class="btn btn-secondary" onclick="history.back()">
              à¸¢à¸à¹€à¸¥à¸´à¸
            </button>
          </div>
        </form>
      </div>
    </div>
  </main>

  <script src="js/i18n.js"></script>
  <script src="js/app.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    if (typeof requireAuth === 'function') requireAuth();
    renderMainNav('mainNav');

    var instrumentIcons = {
      'à¸£à¹‰à¸­à¸‡à¸™à¸³': 'ğŸ¤', 'à¸£à¹‰à¸­à¸‡à¸›à¸£à¸°à¸ªà¸²à¸™': 'ğŸ¤',
      'à¸à¸µà¸•à¸²à¸£à¹Œà¹„à¸Ÿà¸Ÿà¹‰à¸²': 'ğŸ¸', 'à¸à¸µà¸•à¸²à¸£à¹Œà¹‚à¸›à¸£à¹ˆà¸‡': 'ğŸ¸', 'à¸à¸µà¸•à¸²à¸£à¹Œà¹€à¸šà¸ª': 'ğŸ¸',
      'à¸„à¸µà¸¢à¹Œà¸šà¸­à¸£à¹Œà¸”': 'ğŸ¹', 'à¸à¸¥à¸­à¸‡': 'ğŸ¥', 'à¹€à¸à¸­à¸£à¹Œà¸„à¸±à¸ªà¸Šà¸±à¸™': 'ğŸ¥',
      'à¸—à¸£à¸±à¸¡à¹€à¸›à¸•': 'ğŸº', 'à¹à¸‹à¸à¹‚à¸‹à¹‚à¸Ÿà¸™': 'ğŸ·', 'à¹„à¸§à¹‚à¸­à¸¥à¸´à¸™': 'ğŸ»',
      'à¸œà¸¹à¹‰à¸ˆà¸±à¸”à¸à¸²à¸£à¸§à¸‡': 'ğŸ“‹'
    };
    var roleLabels = { admin: 'ğŸ”§ à¹à¸­à¸”à¸¡à¸´à¸™', manager: 'ğŸ‘” à¸œà¸¹à¹‰à¸ˆà¸±à¸”à¸à¸²à¸£à¸§à¸‡', member: 'ğŸ¸ à¸ªà¸¡à¸²à¸Šà¸´à¸' };

    function $el(id) { return document.getElementById(id); }
    function setVal(id, val) { var el = $el(id); if (el && el.tagName === 'SELECT') el.value = val; else if (el) el.value = val; }
    function setTxt(id, val) { var el = $el(id); if (el) el.textContent = val || 'â€”'; }

    function renderDisplay(p) {
      var title     = p.title      || '';
      var firstName = p.firstName  || p.first_name || '';
      var lastName  = p.lastName   || p.last_name  || '';
      var nickname  = p.nickname   || '';
      var inst      = p.instrument || '';
      var fullName  = [title !== 'à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸' ? title : '', firstName, lastName].filter(Boolean).join(' ') || nickname || 'â€”';
      $el('displayFullName').textContent   = fullName;
      $el('displayNickname').textContent   = nickname ? '(' + nickname + ')' : '';
      $el('displayInstrument').textContent = inst;
      $el('avatarIcon').textContent = instrumentIcons[inst] || 'ğŸ¤';
    }

    // â”€â”€ à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function loadProfile() {
      gasRun('getMyProfile', {}, function(r) {
        if (!r || !r.success) return;
        var p = r.data || {};
        setVal('title',      p.title      || 'à¸™à¸²à¸¢');
        setVal('firstName',  p.firstName  || p.first_name || '');
        setVal('lastName',   p.lastName   || p.last_name  || '');
        setVal('nickname',   p.nickname   || '');
        setVal('instrument', p.instrument || '');
        setVal('phone',      p.phone      || '');
        setTxt('profileEmail',  p.email    || 'â€”');
        setTxt('profileBand',   p.bandName || p.band_name || 'â€”');
        setTxt('profileRole',   roleLabels[p.role] || p.role || 'â€”');
        setTxt('profileStatus', p.status === 'active' ? 'âœ… à¹ƒà¸Šà¹‰à¸‡à¸²à¸™' : p.status || 'â€”');
        renderDisplay(p);
      });
    }
    loadProfile();

    // â”€â”€ à¸šà¸±à¸™à¸—à¸¶à¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    $el('profileForm').addEventListener('submit', function(e) {
      e.preventDefault();
      var firstName = $el('firstName').value.trim();
      var lastName  = $el('lastName').value.trim();
      var nickname  = $el('nickname').value.trim();
      if (!firstName || !lastName || !nickname) {
        if (typeof showToast === 'function') showToast('à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­ à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥ à¹à¸¥à¸°à¸Šà¸·à¹ˆà¸­à¹€à¸¥à¹ˆà¸™', 'error');
        return;
      }
      var btn = $el('saveBtn');
      btn.disabled = true; btn.textContent = 'à¸à¸³à¸¥à¸±à¸‡à¸šà¸±à¸™à¸—à¸¶à¸...';

      gasRun('updateMyProfile', {
        title:      $el('title').value,
        firstName:  firstName,
        lastName:   lastName,
        nickname:   nickname,
        instrument: $el('instrument').value,
        phone:      ($el('phone') ? $el('phone').value.trim() : '')
      }, function(r) {
        btn.disabled = false; btn.textContent = 'ğŸ’¾ à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥';
        if (r && r.success) {
          if (typeof showToast === 'function') showToast(r.message || 'à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢', 'success');
          renderDisplay({
            title:      $el('title').value,
            firstName:  firstName,
            lastName:   lastName,
            nickname:   nickname,
            instrument: $el('instrument').value
          });
          // à¸£à¸µà¹‚à¸«à¸¥à¸” nav à¹ƒà¸«à¸¡à¹ˆ
          setTimeout(function() { renderMainNav('mainNav'); }, 300);
        } else {
          if (typeof showToast === 'function') showToast((r && r.message) || 'à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”', 'error');
        }
      });
    });
  });
  </script>
</body>
</html>
