<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô ‚Äî Band Management By SoulCiety</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;700&family=Sarabun:wght@400;500;600&display=swap" rel="stylesheet">
  <?!= include('css_theme') ?>
  <?!= include('css_nav') ?>
  <?!= include('css_browser-compat') ?>
  <style>
    .pricing-section{margin-bottom:var(--spacing-xl)}
    .pricing-row{display:grid;grid-template-columns:2fr 1fr 40px;gap:var(--spacing-sm);align-items:center;margin-bottom:var(--spacing-sm)}
    .pricing-row.header{font-weight:700;font-size:var(--text-sm);color:var(--premium-text-muted);border-bottom:2px solid var(--premium-gold);padding-bottom:var(--spacing-sm);margin-bottom:var(--spacing-md)}
    .pricing-row input,.pricing-row select{font-size:var(--text-sm);padding:8px 10px;border:1px solid #e2e8f0;border-radius:var(--radius-sm);font-family:inherit}
    .pricing-row input:focus,.pricing-row select:focus{border-color:var(--premium-gold);outline:none;box-shadow:0 0 0 3px rgba(249,207,69,.2)}
    .pricing-row .remove-btn{padding:6px 10px;background:#e53e3e;color:#fff;border:none;border-radius:var(--radius-sm);cursor:pointer;font-size:13px}
    .pricing-row .remove-btn:hover{background:#c53030}
    .pricing-tabs{display:flex;gap:4px;margin-bottom:var(--spacing-lg);flex-wrap:wrap}
    .pricing-tab{padding:10px 20px;border-radius:var(--radius-md) var(--radius-md) 0 0;border:2px solid var(--premium-light-gray);border-bottom:none;background:var(--premium-off-white);cursor:pointer;font-size:var(--text-sm);font-weight:600;font-family:inherit;transition:all .15s;color:var(--premium-text-muted)}
    .pricing-tab.active{background:var(--premium-white);border-color:var(--premium-gold);color:var(--premium-gold)}
    .pricing-tab:hover:not(.active){background:var(--premium-white)}
    .pricing-panel{display:none;border:2px solid var(--premium-gold);border-radius:0 var(--radius-lg) var(--radius-lg) var(--radius-lg);padding:var(--spacing-xl);background:var(--premium-white)}
    .pricing-panel.active{display:block}
    .pricing-summary{background:linear-gradient(135deg,#2d3748,#4a5568);color:#fff;border-radius:var(--radius-xl);padding:var(--spacing-xl);margin-bottom:var(--spacing-xl);display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:var(--spacing-lg);text-align:center}
    .pricing-summary .val{font-size:var(--text-2xl);font-weight:700;color:var(--premium-gold)}
    .pricing-summary .lbl{font-size:var(--text-xs);color:#cbd5e0;margin-top:4px}
    .ext-pricing-row{display:grid;grid-template-columns:2fr 1fr 1fr 40px;gap:var(--spacing-sm);align-items:center;margin-bottom:var(--spacing-sm)}
    .ext-pricing-row.header{font-weight:700;font-size:var(--text-sm);color:var(--premium-text-muted);border-bottom:2px solid var(--premium-gold);padding-bottom:var(--spacing-sm);margin-bottom:var(--spacing-md)}
    .ext-pricing-row input,.ext-pricing-row select{font-size:var(--text-sm);padding:8px 10px;border:1px solid #e2e8f0;border-radius:var(--radius-sm);font-family:inherit}
    .service-pricing-row{display:grid;grid-template-columns:3fr 1fr 1fr 40px;gap:var(--spacing-sm);align-items:center;margin-bottom:var(--spacing-sm)}
    .service-pricing-row.header{font-weight:700;font-size:var(--text-sm);color:var(--premium-text-muted);border-bottom:2px solid var(--premium-gold);padding-bottom:var(--spacing-sm);margin-bottom:var(--spacing-md)}
    .service-pricing-row input{font-size:var(--text-sm);padding:8px 10px;border:1px solid #e2e8f0;border-radius:var(--radius-sm);font-family:inherit}
    .fund-settings{display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-md)}
    @media(max-width:480px){.fund-settings{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div id="mainNav"></div>
  <div id="toast"></div>
  <div id="confirmModal"></div>
  <main>
    <div class="container">
      <div class="page-header">
        <h1 class="page-title" data-i18n="nav_pricing">üí≤ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</h1>
        <button class="btn btn-primary" onclick="saveAllPricing()" id="saveAllBtn" data-i18n="save">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      </div>

      <!-- Summary -->
      <div class="pricing-summary">
        <div><div class="val" id="sumJobTypes">0</div><div class="lbl">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</div></div>
        <div><div class="val" id="sumPositions">0</div><div class="lbl">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á/‡∏≠‡∏±‡∏ï‡∏£‡∏≤</div></div>
        <div><div class="val" id="sumServices">0</div><div class="lbl">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</div></div>
        <div><div class="val" id="sumExternal">0</div><div class="lbl">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏ô‡∏ô‡∏≠‡∏Å</div></div>
      </div>

      <!-- Tabs -->
      <div class="pricing-tabs">
        <button class="pricing-tab active" onclick="switchTab('jobTypes')">üìÖ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</button>
        <button class="pricing-tab" onclick="switchTab('positions')">üé∏ ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á/‡∏≠‡∏±‡∏ï‡∏£‡∏≤</button>
        <button class="pricing-tab" onclick="switchTab('services')">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤)</button>
        <button class="pricing-tab" onclick="switchTab('external')">üë§ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏ô‡∏ô‡∏≠‡∏Å</button>
        <button class="pricing-tab" onclick="switchTab('fundSettings')">üè¶ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏á</button>
      </div>

      <!-- Panel 1: Job Type Pricing -->
      <div class="pricing-panel active" id="panel-jobTypes">
        <div class="card-header" style="margin-bottom:var(--spacing-md)">
          <h3 class="card-title">üìÖ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</h3>
          <button class="btn btn-secondary btn-sm" onclick="addJobType()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</button>
        </div>
        <p style="font-size:var(--text-xs);color:var(--premium-text-muted);margin-bottom:var(--spacing-md)">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‚Äî ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏ô "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô" ‡πÅ‡∏•‡∏∞ "‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß"</p>
        <div class="pricing-row header"><span>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</span><span>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (‡∏ö‡∏≤‡∏ó)</span><span></span></div>
        <div id="jobTypeList"></div>
      </div>

      <!-- Panel 2: Position Rates -->
      <div class="pricing-panel" id="panel-positions">
        <div class="card-header" style="margin-bottom:var(--spacing-md)">
          <h3 class="card-title">üé∏ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</h3>
          <button class="btn btn-secondary btn-sm" onclick="addPosition()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</button>
        </div>
        <p style="font-size:var(--text-xs);color:var(--premium-text-muted);margin-bottom:var(--spacing-md)">‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏£‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô) ‡πÉ‡∏ô "‡πÄ‡∏ö‡∏¥‡∏Å-‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß"</p>
        <div class="pricing-row header"><span>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</span><span>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß (‡∏ö‡∏≤‡∏ó/‡∏á‡∏≤‡∏ô)</span><span></span></div>
        <div id="positionList"></div>
      </div>

      <!-- Panel 3: Service Items (for Quotation) -->
      <div class="pricing-panel" id="panel-services">
        <div class="card-header" style="margin-bottom:var(--spacing-md)">
          <h3 class="card-title">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ</h3>
          <button class="btn btn-secondary btn-sm" onclick="addService()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
        </div>
        <p style="font-size:var(--text-xs);color:var(--premium-text-muted);margin-bottom:var(--spacing-md)">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á "‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤" ‚Äî ‡∏Å‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
        <div class="service-pricing-row header"><span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</span><span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</span><span>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡∏ö‡∏≤‡∏ó)</span><span></span></div>
        <div id="serviceList"></div>
      </div>

      <!-- Panel 4: External Worker Rates -->
      <div class="pricing-panel" id="panel-external">
        <div class="card-header" style="margin-bottom:var(--spacing-md)">
          <h3 class="card-title">üë§ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡∏ô‡∏≠‡∏Å</h3>
          <button class="btn btn-secondary btn-sm" onclick="addExternal()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</button>
        </div>
        <p style="font-size:var(--text-xs);color:var(--premium-text-muted);margin-bottom:var(--spacing-md)">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏Ñ‡∏ô‡∏ô‡∏≠‡∏Å" ‚Äî ‡πÄ‡∏ï‡∏¥‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</p>
        <div class="ext-pricing-row header"><span>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏ô‡∏ô‡∏≠‡∏Å</span><span>‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (‡∏ö‡∏≤‡∏ó)</span><span>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</span><span></span></div>
        <div id="externalList"></div>
      </div>

      <!-- Panel 5: Fund Settings -->
      <div class="pricing-panel" id="panel-fundSettings">
        <div class="card-header" style="margin-bottom:var(--spacing-md)">
          <h3 class="card-title">üè¶ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏á</h3>
        </div>
        <p style="font-size:var(--text-xs);color:var(--premium-text-muted);margin-bottom:var(--spacing-md)">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Å‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‚Äî ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô "‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß" ‡πÅ‡∏•‡∏∞ "‡πÄ‡∏ö‡∏¥‡∏Å-‡∏à‡πà‡∏≤‡∏¢"</p>
        <div class="fund-settings">
          <div class="form-group">
            <label>‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Å‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏á (%)</label>
            <input type="number" id="fundPercent" value="10" min="0" max="100" step="0.5">
          </div>
          <div class="form-group">
            <label>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
            <input type="number" id="defaultExpense" value="0" min="0">
          </div>
        </div>
      </div>

    </div>
  </main>

  <?!= include('js_i18n') ?>
  <?!= include('js_app') ?>
  <?!= include('js_nav') ?>
  <script>
  /* ‚îÄ‚îÄ‚îÄ Data ‚îÄ‚îÄ‚îÄ */
  var pricingData = {
    jobTypes: [],
    positions: [],
    services: [],
    external: [],
    fundPercent: 10,
    defaultExpense: 0
  };

  /* ‚îÄ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ */
  document.addEventListener('DOMContentLoaded', function(){
    requireAuth(); renderMainNav('mainNav'); applyTranslations();
    loadPricing();
  });

  /* ‚îÄ‚îÄ‚îÄ Tab switching ‚îÄ‚îÄ‚îÄ */
  function switchTab(tab){
    document.querySelectorAll('.pricing-tab').forEach(function(t,i){ t.classList.remove('active'); });
    document.querySelectorAll('.pricing-panel').forEach(function(p){ p.classList.remove('active'); });
    document.getElementById('panel-'+tab).classList.add('active');
    var tabs=['jobTypes','positions','services','external','fundSettings'];
    document.querySelectorAll('.pricing-tab')[tabs.indexOf(tab)].classList.add('active');
  }

  /* ‚îÄ‚îÄ‚îÄ Load/Save ‚îÄ‚îÄ‚îÄ */
  function loadPricing(){
    // Try localStorage cache first
    try {
      var cached = localStorage.getItem('pricingData');
      if(cached) { pricingData = JSON.parse(cached); renderAll(); }
    } catch(e){}
    // Then fetch from server
    gasRun('getPricing', { bandId: localStorage.getItem('bandId')||'' }, function(r){
      if(r && r.success && r.data){
        pricingData = r.data;
        localStorage.setItem('pricingData', JSON.stringify(pricingData));
        renderAll();
      } else if(!pricingData.jobTypes.length){
        // Load defaults
        pricingData = getDefaults();
        renderAll();
      }
    });
  }

  function getDefaults(){
    return {
      jobTypes: [
        { name:'‡∏á‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏á', price:25000 },
        { name:'‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', price:20000 },
        { name:'‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ï', price:35000 },
        { name:'‡∏ã‡πâ‡∏≠‡∏°', price:0 },
        { name:'‡∏≠‡∏∑‡πà‡∏ô‡πÜ', price:15000 }
      ],
      positions: [
        { name:'‡∏ô‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏á', rate:3000 },
        { name:'‡∏Å‡∏µ‡∏ï‡∏≤‡∏£‡πå', rate:2500 },
        { name:'‡πÄ‡∏ö‡∏™', rate:2500 },
        { name:'‡∏Å‡∏•‡∏≠‡∏á', rate:2500 },
        { name:'‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î', rate:2500 }
      ],
      services: [
        { desc:'‡∏ß‡∏á‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡∏™‡∏î 5 ‡∏ä‡∏¥‡πâ‡∏ô', qty:1, price:20000 },
        { desc:'‡∏ô‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏á (‡πÄ‡∏û‡∏¥‡πà‡∏°)', qty:1, price:3000 },
        { desc:'‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á PA', qty:1, price:5000 },
        { desc:'‡πÑ‡∏ü‡πÄ‡∏ß‡∏ó‡∏µ', qty:1, price:3000 },
        { desc:'‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á', qty:1, price:2000 }
      ],
      external: [
        { type:'‡∏ô‡∏±‡∏Å‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡πÄ‡∏Å‡∏™‡∏ï‡πå', rate:2500, note:'' },
        { type:'‡∏ô‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏™‡∏ï‡πå', rate:3000, note:'' },
        { type:'‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡πÄ‡∏ä‡∏µ‡∏¢‡∏ô', rate:2000, note:'' },
        { type:'‡∏≠‡∏∑‡πà‡∏ô‡πÜ', rate:1500, note:'' }
      ],
      fundPercent: 10,
      defaultExpense: 0
    };
  }

  function saveAllPricing(){
    collectData();
    var btn = document.getElementById('saveAllBtn');
    btn.disabled = true; btn.textContent = t('loading');
    localStorage.setItem('pricingData', JSON.stringify(pricingData));
    gasRun('savePricing', { bandId: localStorage.getItem('bandId')||'', data: pricingData }, function(r){
      btn.disabled = false; btn.textContent = 'üíæ ' + t('save');
      if(r && r.success){ showToast(t('msg_saveSuccess')||'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','success'); }
      else { showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß (offline)','info'); }
      updateSummary();
    });
  }

  function collectData(){
    pricingData.jobTypes = [];
    document.querySelectorAll('#jobTypeList .pricing-row').forEach(function(row){
      var inputs = row.querySelectorAll('input');
      if(inputs[0] && inputs[0].value.trim()){
        pricingData.jobTypes.push({ name: inputs[0].value.trim(), price: parseFloat(inputs[1].value)||0 });
      }
    });
    pricingData.positions = [];
    document.querySelectorAll('#positionList .pricing-row').forEach(function(row){
      var inputs = row.querySelectorAll('input');
      if(inputs[0] && inputs[0].value.trim()){
        pricingData.positions.push({ name: inputs[0].value.trim(), rate: parseFloat(inputs[1].value)||0 });
      }
    });
    pricingData.services = [];
    document.querySelectorAll('#serviceList .service-pricing-row').forEach(function(row){
      var inputs = row.querySelectorAll('input');
      if(inputs[0] && inputs[0].value.trim()){
        pricingData.services.push({ desc: inputs[0].value.trim(), qty: parseFloat(inputs[1].value)||1, price: parseFloat(inputs[2].value)||0 });
      }
    });
    pricingData.external = [];
    document.querySelectorAll('#externalList .ext-pricing-row').forEach(function(row){
      var inputs = row.querySelectorAll('input');
      if(inputs[0] && inputs[0].value.trim()){
        pricingData.external.push({ type: inputs[0].value.trim(), rate: parseFloat(inputs[1].value)||0, note: inputs[2]?inputs[2].value:'' });
      }
    });
    pricingData.fundPercent = parseFloat(document.getElementById('fundPercent').value)||0;
    pricingData.defaultExpense = parseFloat(document.getElementById('defaultExpense').value)||0;
  }

  /* ‚îÄ‚îÄ‚îÄ Render All ‚îÄ‚îÄ‚îÄ */
  function renderAll(){
    renderJobTypes();
    renderPositions();
    renderServices();
    renderExternal();
    document.getElementById('fundPercent').value = pricingData.fundPercent||10;
    document.getElementById('defaultExpense').value = pricingData.defaultExpense||0;
    updateSummary();
  }

  function updateSummary(){
    document.getElementById('sumJobTypes').textContent = pricingData.jobTypes.length;
    document.getElementById('sumPositions').textContent = pricingData.positions.length;
    document.getElementById('sumServices').textContent = pricingData.services.length;
    document.getElementById('sumExternal').textContent = pricingData.external.length;
  }

  /* ‚îÄ‚îÄ‚îÄ Job Types ‚îÄ‚îÄ‚îÄ */
  function renderJobTypes(){
    var html = pricingData.jobTypes.map(function(jt, i){
      return '<div class="pricing-row">'
        +'<input type="text" value="'+escapeHtml(jt.name)+'" placeholder="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô">'
        +'<input type="number" value="'+(jt.price||0)+'" min="0" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤">'
        +'<button class="remove-btn" onclick="removeJobType('+i+')">√ó</button>'
        +'</div>';
    }).join('');
    document.getElementById('jobTypeList').innerHTML = html;
  }
  function addJobType(){ pricingData.jobTypes.push({name:'',price:0}); renderJobTypes(); }
  function removeJobType(i){ collectData(); pricingData.jobTypes.splice(i,1); renderJobTypes(); updateSummary(); }

  /* ‚îÄ‚îÄ‚îÄ Positions ‚îÄ‚îÄ‚îÄ */
  function renderPositions(){
    var html = pricingData.positions.map(function(p, i){
      return '<div class="pricing-row">'
        +'<input type="text" value="'+escapeHtml(p.name)+'" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á">'
        +'<input type="number" value="'+(p.rate||0)+'" min="0" placeholder="‡∏≠‡∏±‡∏ï‡∏£‡∏≤">'
        +'<button class="remove-btn" onclick="removePosition('+i+')">√ó</button>'
        +'</div>';
    }).join('');
    document.getElementById('positionList').innerHTML = html;
  }
  function addPosition(){ pricingData.positions.push({name:'',rate:0}); renderPositions(); }
  function removePosition(i){ collectData(); pricingData.positions.splice(i,1); renderPositions(); updateSummary(); }

  /* ‚îÄ‚îÄ‚îÄ Services ‚îÄ‚îÄ‚îÄ */
  function renderServices(){
    var html = pricingData.services.map(function(s, i){
      return '<div class="service-pricing-row">'
        +'<input type="text" value="'+escapeHtml(s.desc)+'" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£">'
        +'<input type="number" value="'+(s.qty||1)+'" min="0" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">'
        +'<input type="number" value="'+(s.price||0)+'" min="0" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢">'
        +'<button class="remove-btn" onclick="removeService('+i+')">√ó</button>'
        +'</div>';
    }).join('');
    document.getElementById('serviceList').innerHTML = html;
  }
  function addService(){ pricingData.services.push({desc:'',qty:1,price:0}); renderServices(); }
  function removeService(i){ collectData(); pricingData.services.splice(i,1); renderServices(); updateSummary(); }

  /* ‚îÄ‚îÄ‚îÄ External ‚îÄ‚îÄ‚îÄ */
  function renderExternal(){
    var html = pricingData.external.map(function(e, i){
      return '<div class="ext-pricing-row">'
        +'<input type="text" value="'+escapeHtml(e.type)+'" placeholder="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó">'
        +'<input type="number" value="'+(e.rate||0)+'" min="0" placeholder="‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß">'
        +'<input type="text" value="'+escapeHtml(e.note||'')+'" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏">'
        +'<button class="remove-btn" onclick="removeExternal('+i+')">√ó</button>'
        +'</div>';
    }).join('');
    document.getElementById('externalList').innerHTML = html;
  }
  function addExternal(){ pricingData.external.push({type:'',rate:0,note:''}); renderExternal(); }
  function removeExternal(i){ collectData(); pricingData.external.splice(i,1); renderExternal(); updateSummary(); }
  </script>
</body>
</html>
