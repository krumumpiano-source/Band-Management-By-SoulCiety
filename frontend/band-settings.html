<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏á ‚Äî Band Management By SoulCiety</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;700&family=Sarabun:wght@400;500;600&display=swap" rel="stylesheet">
  <?!= include('css_theme') ?>
  <?!= include('css_nav') ?>
  <?!= include('css_browser-compat') ?>
  <style>
    .info-grid{display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-md)}
    @media(max-width:600px){.info-grid{grid-template-columns:1fr}}
    .invite-box{background:linear-gradient(135deg,#1a202c,#2d3748);border:1px solid var(--premium-gold);border-radius:var(--radius-lg);padding:var(--spacing-lg);margin-top:var(--spacing-md)}
    .invite-code-display{font-family:monospace;font-size:2rem;font-weight:700;letter-spacing:.25em;color:var(--premium-gold);text-align:center;padding:14px;background:#111827;border-radius:var(--radius-md);margin:var(--spacing-md) 0;cursor:pointer;user-select:all}
    .invite-code-display.empty{font-size:var(--text-sm);color:#4b5563;letter-spacing:normal;font-weight:400;font-family:inherit}
    .invite-actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
    .invite-hint{font-size:var(--text-xs);color:#6b7280;text-align:center;margin-top:8px}
    .invite-expires{font-size:var(--text-xs);color:#9ca3af;text-align:center;margin-top:2px;min-height:16px}
    .member-item{display:flex;align-items:flex-end;gap:var(--spacing-md);padding:var(--spacing-md);background:var(--premium-off-white);border-radius:var(--radius-md);margin-bottom:var(--spacing-sm);flex-wrap:wrap}
    .member-item .form-group{flex:1;min-width:130px;margin-bottom:0}
    .member-remove{padding:8px 12px;background:#e53e3e;color:#fff;border:none;border-radius:var(--radius-sm);cursor:pointer;flex-shrink:0;align-self:flex-end}
    .venue-card{background:var(--premium-white);border:1px solid #e2e8f0;border-radius:var(--radius-lg);margin-bottom:var(--spacing-lg);overflow:hidden}
    .venue-card-header{background:linear-gradient(135deg,#1a202c,#2d3748);padding:var(--spacing-md) var(--spacing-lg);display:flex;align-items:flex-end;gap:var(--spacing-md);flex-wrap:wrap}
    .venue-card-inputs{display:flex;gap:var(--spacing-md);flex:1;flex-wrap:wrap}
    .venue-card-inputs .form-group{flex:1;min-width:120px;margin-bottom:0}
    .venue-card-inputs input{background:#1f2937;border-color:#374151;color:#f3f4f6}
    .venue-card-inputs input::placeholder{color:#6b7280}
    .venue-card-inputs label{color:#9ca3af;font-size:var(--text-xs)}
    .venue-remove-btn{padding:8px 12px;background:rgba(229,62,62,.15);border:1px solid rgba(229,62,62,.4);color:#f87171;border-radius:var(--radius-sm);cursor:pointer;font-size:14px;flex-shrink:0;align-self:flex-end}
    .venue-remove-btn:hover{background:#e53e3e;color:#fff}
    .venue-schedule-body{padding:var(--spacing-md) var(--spacing-lg) var(--spacing-lg)}
    .day-tabs{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:var(--spacing-md)}
    .day-tab{padding:6px 12px;background:var(--premium-off-white);border:2px solid #e2e8f0;border-radius:var(--radius-md);cursor:pointer;font-size:var(--text-xs);font-weight:600;font-family:inherit;transition:all .15s;position:relative}
    .day-tab.active{background:var(--premium-gold);color:#fff;border-color:var(--premium-gold)}
    .day-tab.has-data{border-color:var(--premium-gold);color:var(--premium-gold)}
    .day-tab.active.has-data{color:#fff}
    .day-tab.has-data::after{content:'';position:absolute;top:3px;right:3px;width:5px;height:5px;background:var(--premium-gold);border-radius:50%}
    .day-tab.active.has-data::after{background:#fff}
    .venue-day-panel{display:none}.venue-day-panel.active{display:block}
    .time-slot-item{background:var(--premium-off-white);border-radius:var(--radius-md);padding:var(--spacing-md);margin-bottom:var(--spacing-md);border:1px solid #e2e8f0}
    .ts-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--spacing-sm);flex-wrap:wrap;gap:6px}
    .ts-time-label{font-weight:700;font-size:var(--text-sm);color:var(--premium-gold)}
    .ts-inputs{display:flex;gap:var(--spacing-md);flex-wrap:wrap;margin-bottom:var(--spacing-sm)}
    .ts-inputs .form-group{flex:1;min-width:120px;margin-bottom:0}
    .btn-icon-small{padding:4px 10px;background:#e53e3e;color:#fff;border:none;border-radius:var(--radius-sm);cursor:pointer;font-size:12px}
    .member-rate-row{display:flex;align-items:center;gap:8px;margin-bottom:6px;flex-wrap:wrap}
    .member-rate-row select,.member-rate-row input[type=number]{flex:1;min-width:110px;padding:7px 10px;border:1px solid #e2e8f0;border-radius:var(--radius-sm);font-size:var(--text-sm);font-family:inherit}
    .rate-unit{font-size:var(--text-xs);color:var(--premium-text-muted);white-space:nowrap}
    .member-rate-remove{padding:5px 9px;background:#e53e3e;color:#fff;border:none;border-radius:var(--radius-sm);cursor:pointer;flex-shrink:0}
    .empty-state-small{color:var(--premium-text-muted);font-size:var(--text-sm);margin:6px 0}
    #toast{display:none;position:fixed;bottom:24px;right:24px;background:var(--premium-gold);color:#fff;padding:12px 20px;border-radius:var(--radius-md);z-index:9999;box-shadow:0 4px 12px rgba(0,0,0,.25)}
    #toast.show{display:block}
  </style>
</head>
<body>
  <div id="mainNav"></div>
  <div id="toast"><span class="toast-message"></span></div>
  <main>
    <div class="container">
      <div class="page-header">
        <h1 class="page-title">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏á</h1>
        <button id="saveBtn" class="btn btn-primary">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
      </div>

      <div class="card">
        <div class="card-header"><h3 class="card-title">üéµ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏á</h3></div>
        <div class="info-grid">
          <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏á</label><input type="text" id="bandName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏á‡∏î‡∏ô‡∏ï‡∏£‡∏µ"></div>
          <div class="form-group"><label>‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏á</label><input type="text" id="bandManager" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏á"></div>
        </div>
      </div>

      <div class="card">
        <div class="card-header" style="justify-content:space-between">
          <h3 class="card-title">üë• ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ß‡∏á</h3>
          <button id="addMemberBtn" class="btn btn-primary btn-sm">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
        </div>
        <div id="noMembers" style="display:none"><p class="empty-state-small">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</p></div>
        <div id="membersList"></div>
        <div class="invite-box">
          <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;margin-bottom:4px">
            <div>
              <div style="font-weight:700;color:var(--premium-gold);font-size:var(--text-sm)">üîë ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏ä‡∏¥‡∏ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</div>
              <div style="font-size:var(--text-xs);color:#9ca3af;margin-top:2px">‡πÅ‡∏ä‡∏£‡πå‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ß‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
            </div>
          </div>
          <div id="inviteCodeDisplay" class="invite-code-display empty" onclick="copyInviteCode()">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏ä‡∏¥‡∏ç</div>
          <div class="invite-expires" id="inviteExpires"></div>
          <div class="invite-actions">
            <button type="button" class="btn btn-sm btn-secondary" id="genInviteBtn" onclick="generateInviteCode()">üé≤ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏´‡∏°‡πà</button>
            <button type="button" class="btn btn-sm btn-primary" id="copyInviteBtn" style="display:none" onclick="copyInviteCode()">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
          </div>
          <div class="invite-hint">‡∏£‡∏´‡∏±‡∏™‡∏°‡∏µ‡∏≠‡∏≤‡∏¢‡∏∏ 7 ‡∏ß‡∏±‡∏ô ‚Ä¢ ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ß‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</div>
        </div>
      </div>

      <div class="card">
        <div class="card-header" style="justify-content:space-between">
          <h3 class="card-title">üè¢ ‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô</h3>
          <button id="addVenueBtn" class="btn btn-primary btn-sm">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡πâ‡∏≤‡∏ô</button>
        </div>
        <p style="font-size:var(--text-xs);color:var(--premium-text-muted);margin-bottom:var(--spacing-md)">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡πâ‡∏≤‡∏ô ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á</p>
        <div id="noVenues" style="display:none"><p class="empty-state-small">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡πâ‡∏≤‡∏ô ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚ûï ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏£‡∏Å</p></div>
        <div id="venuesList"></div>
      </div>

      <div style="display:flex;justify-content:flex-end;padding-bottom:var(--spacing-xl)">
        <button class="btn btn-primary btn-lg" onclick="document.getElementById('saveBtn').click()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
      </div>
    </div>
  </main>
  <?!= include('js_i18n') ?>
  <?!= include('js_app') ?>
  <?!= include('js_nav') ?>
  <?!= include('js_band-members') ?>
  <script src="js/band-settings.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      requireAuth(); renderMainNav('mainNav'); applyTranslations();
    });
  </script>
</body>
</html>
  <style>
    .settings-layout{display:grid;grid-template-columns:200px 1fr;gap:var(--spacing-xl)}
    @media(max-width:768px){.settings-layout{grid-template-columns:1fr}}
    .settings-nav{display:flex;flex-direction:column;gap:2px}
    .s-nav-item{padding:var(--spacing-sm) var(--spacing-md);border-radius:var(--radius-md);cursor:pointer;font-size:var(--text-sm);color:var(--premium-text-muted);transition:all .15s}
    .s-nav-item.active,.s-nav-item:hover{background:var(--premium-gold);color:#fff}
    .section-panel{display:none}.section-panel.active{display:block}
    .rate-row{display:flex;align-items:center;gap:var(--spacing-md);margin-bottom:var(--spacing-sm)}
    .rate-row label{flex:1;font-size:var(--text-sm)}
    .rate-row input{width:120px;font-size:var(--text-sm)}
    .rate-row .del-btn{flex-shrink:0}
    .venue-tag{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;background:var(--premium-off-white);border-radius:var(--radius-full);font-size:var(--text-sm);margin:4px}
    .venue-tag button{border:none;background:none;cursor:pointer;color:var(--premium-text-muted);font-size:14px;line-height:1;padding:0}
  </style>
</head>
<body>
  <div id="mainNav"></div>
  <div id="toast"></div>
  <main>
    <div class="container">
      <div class="page-header">
        <h1 class="page-title" data-i18n="nav_settings">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏á</h1>
        <button class="btn btn-primary" onclick="saveAll()" data-i18n="save">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      </div>
      <div class="settings-layout">
        <div>
          <div class="card">
            <div class="settings-nav">
              <div class="s-nav-item active" onclick="showSection('band',this)">üéµ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏á</div>
              <div class="s-nav-item" onclick="showSection('venues',this)">üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</div>
              <div class="s-nav-item" onclick="showSection('rates',this)">üí∞ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß</div>
              <div class="s-nav-item" onclick="showSection('app',this)">‚öôÔ∏è ‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô</div>
            </div>
          </div>
        </div>
        <div>
          <!-- Band Info -->
          <div class="card section-panel active" id="panel-band">
            <div class="card-header"><h3 class="card-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏á‡∏î‡∏ô‡∏ï‡∏£‡∏µ</h3></div>
            <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏á *</label><input type="text" id="bandName"></div>
            <div class="form-group"><label>‡πÅ‡∏ô‡∏ß‡∏î‡∏ô‡∏ï‡∏£‡∏µ</label><input type="text" id="bandGenre" placeholder="Pop, Rock, Jazz..."></div>
            <div class="form-group"><label>‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á</label><input type="number" id="bandFounded" placeholder="2020"></div>
            <div class="form-group"><label>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡∏á</label><textarea id="bandDesc" rows="3"></textarea></div>
            <div class="form-group"><label>‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå / Facebook</label><input type="url" id="bandUrl"></div>
          </div>
          <!-- Venues -->
          <div class="card section-panel" id="panel-venues">
            <div class="card-header"><h3 class="card-title">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡πà‡∏≠‡∏¢</h3></div>
            <div id="venueTags" style="margin-bottom:var(--spacing-md)"></div>
            <div style="display:flex;gap:var(--spacing-sm)">
              <input type="text" id="newVenueInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà">
              <button type="button" class="btn btn-primary" onclick="addVenue()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
            </div>
          </div>
          <!-- Hourly Rates -->
          <div class="card section-panel" id="panel-rates">
            <div class="card-header"><h3 class="card-title">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</h3></div>
            <div id="rateRows"></div>
            <button type="button" class="btn btn-ghost btn-sm" onclick="addRateRow()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</button>
          </div>
          <!-- App Settings -->
          <div class="card section-panel" id="panel-app">
            <div class="card-header"><h3 class="card-title">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô</h3></div>
            <div class="form-group"><label>‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
              <select id="defaultLang"><option value="th">‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</option><option value="en">English</option></select>
            </div>
            <div class="form-group"><label>‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô</label>
              <select id="currency"><option value="THB">THB (‡∏ö‡∏≤‡∏ó)</option><option value="USD">USD</option></select>
            </div>
            <div class="form-group">
              <label style="display:flex;align-items:center;gap:var(--spacing-sm);cursor:pointer">
                <input type="checkbox" id="enableVat" style="width:auto"> ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ VAT ‡πÉ‡∏ô‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤
              </label>
            </div>
            <div class="form-group"><label>VAT ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (%)</label><input type="number" id="defaultVat" value="7" min="0"></div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <?!= include('js_i18n') ?>
  <?!= include('js_app') ?>
  <?!= include('js_nav') ?>
  <script>
  var venues = [], rates = [], settingsData = {};
  document.addEventListener('DOMContentLoaded', function() {
    requireAuth(); renderMainNav('mainNav'); applyTranslations();
    gasRun('getBandSettings', {}, function(r) {
      if (r && r.success && r.data) {
        settingsData = r.data;
        var b = (r.data.bands && r.data.bands[0]) || {};
        document.getElementById('bandName').value = b.name || '';
        document.getElementById('bandGenre').value = b.genre || '';
        document.getElementById('bandFounded').value = b.founded || '';
        document.getElementById('bandDesc').value = b.description || '';
        document.getElementById('bandUrl').value = b.website || '';
        venues = r.data.venues || [];
        rates = r.data.hourlyRates || [];
        renderVenuesTags(); renderRateRows();
        var appCfg = r.data.appConfig || {};
        document.getElementById('defaultLang').value = appCfg.defaultLang || 'th';
        document.getElementById('currency').value = appCfg.currency || 'THB';
        document.getElementById('enableVat').checked = !!appCfg.enableVat;
        document.getElementById('defaultVat').value = appCfg.defaultVat || 7;
      }
    });
  });

  function showSection(id, el) {
    document.querySelectorAll('.section-panel').forEach(function(p){p.classList.remove('active');});
    document.getElementById('panel-'+id).classList.add('active');
    document.querySelectorAll('.s-nav-item').forEach(function(n){n.classList.remove('active');});
    el.classList.add('active');
  }

  function renderVenuesTags() {
    document.getElementById('venueTags').innerHTML = venues.map(function(v, i) {
      return '<span class="venue-tag">'+escapeHtml(v)+'<button onclick="removeVenue('+i+')">√ó</button></span>';
    }).join('');
  }

  function addVenue() {
    var val = document.getElementById('newVenueInput').value.trim();
    if (!val) return;
    venues.push(val);
    document.getElementById('newVenueInput').value = '';
    renderVenuesTags();
  }

  function removeVenue(i) { venues.splice(i, 1); renderVenuesTags(); }

  function renderRateRows() {
    document.getElementById('rateRows').innerHTML = rates.map(function(r, i) {
      return '<div class="rate-row">'
        +'<input type="text" value="'+escapeHtml(r.position||'')+'" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á" class="r-pos" onchange="updateRate('+i+',\'position\',this.value)">'
        +'<input type="number" value="'+(r.rate||'')+'" placeholder="‡∏ö‡∏≤‡∏ó/‡∏á‡∏≤‡∏ô" class="r-rate" onchange="updateRate('+i+',\'rate\',this.value)">'
        +'<button class="btn btn-danger btn-sm del-btn" onclick="removeRate('+i+')">√ó</button></div>';
    }).join('');
  }

  function addRateRow() { rates.push({position:'',rate:0}); renderRateRows(); }
  function removeRate(i) { rates.splice(i,1); renderRateRows(); }
  function updateRate(i,field,val) { if(rates[i]) rates[i][field]=val; }

  function saveAll() {
    var payload = {
      bands: [{ name: document.getElementById('bandName').value.trim(), genre: document.getElementById('bandGenre').value.trim(), founded: document.getElementById('bandFounded').value, description: document.getElementById('bandDesc').value, website: document.getElementById('bandUrl').value.trim() }],
      venues: venues, hourlyRates: rates,
      appConfig: { defaultLang: document.getElementById('defaultLang').value, currency: document.getElementById('currency').value, enableVat: document.getElementById('enableVat').checked, defaultVat: document.getElementById('defaultVat').value }
    };
    gasRun('saveBandSettings', payload, function(r) {
      if (r && r.success) showToast(t('msg_saved'), 'success');
      else showToast((r && r.message) || t('msg_error'), 'error');
    });
  }
  </script>
</body>
</html>
