<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard ‚Äî Band Management By SoulCiety</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;700&family=Sarabun:wght@400;500;600&display=swap" rel="stylesheet">
  <?!= include('css_theme') ?>
  <?!= include('css_nav') ?>
  <?!= include('css_browser-compat') ?>
  <style>
    .stat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:var(--spacing-lg);margin-bottom:var(--spacing-xl)}
    .stat-card{background:var(--premium-white);border-radius:var(--radius-lg);box-shadow:var(--shadow-md);padding:var(--spacing-xl);display:flex;align-items:center;gap:var(--spacing-md)}
    .stat-icon{width:52px;height:52px;border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
    .stat-icon.gold{background:#fef3c7}.stat-icon.blue{background:#dbeafe}.stat-icon.green{background:#d1fae5}.stat-icon.purple{background:#ede9fe}
    .stat-body h3{font-size:var(--text-2xl);font-weight:700;color:var(--premium-text)}.stat-body p{font-size:var(--text-sm);color:var(--premium-text-light)}
    .dash-row{display:grid;grid-template-columns:2fr 1fr;gap:var(--spacing-xl)}
    @media(max-width:768px){.dash-row{grid-template-columns:1fr}}
    .quick-actions{display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-sm)}
    .quick-btn{padding:var(--spacing-md);border-radius:var(--radius-md);background:var(--premium-light-gray);border:none;cursor:pointer;text-align:center;font-size:var(--text-sm);font-family:var(--font-family-body);color:var(--premium-text);transition:background .2s,transform .1s}
    .quick-btn:hover{background:var(--premium-gold);color:#fff;transform:translateY(-1px)}
    .job-item{display:flex;align-items:center;gap:var(--spacing-md);padding:var(--spacing-md) 0;border-bottom:1px solid var(--premium-light-gray)}
    .job-item:last-child{border-bottom:none}
    .job-date-box{width:48px;text-align:center;background:var(--premium-off-white);border-radius:var(--radius-md);padding:6px}
    .job-date-box .dd{font-size:var(--text-xl);font-weight:700;color:var(--premium-gold);line-height:1}
    .job-date-box .mm{font-size:10px;color:var(--premium-text-muted);text-transform:uppercase}
    .job-info h4{font-size:var(--text-sm);font-weight:600;margin:0}
    .job-info p{font-size:var(--text-xs);color:var(--premium-text-muted);margin:2px 0 0}
    .finance-row{display:flex;justify-content:space-between;padding:var(--spacing-sm) 0;border-bottom:1px solid var(--premium-light-gray);font-size:var(--text-sm)}
    .finance-row:last-child{border-bottom:none}
    .finance-row .label{color:var(--premium-text-light)}
    .finance-row .val-pos{color:#276749;font-weight:600}
    .finance-row .val-neg{color:#c53030;font-weight:600}
    .welcome-bar{background:linear-gradient(135deg,#2d3748,#4a5568);color:#fff;border-radius:var(--radius-xl);padding:var(--spacing-xl) var(--spacing-2xl);margin-bottom:var(--spacing-xl);display:flex;align-items:center;justify-content:space-between}
    .welcome-bar h2{font-size:var(--text-xl);font-weight:700;margin:0}
    .welcome-bar p{font-size:var(--text-sm);color:#cbd5e0;margin:4px 0 0}
    @media(max-width:480px){.welcome-bar{flex-direction:column;align-items:flex-start;gap:var(--spacing-sm)}.quick-actions{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div id="mainNav"></div>
  <div id="toast"></div>
  <main>
    <div class="container">
      <div class="welcome-bar">
        <div>
          <h2>üéµ <span id="welcomeName"></span></h2>
          <p id="welcomeBand"></p>
        </div>
        <div style="font-size:32px">ü•Å</div>
      </div>

      <!-- Stat Cards -->
      <div class="stat-grid">
        <div class="stat-card">
          <div class="stat-icon gold">üé∏</div>
          <div class="stat-body"><h3 id="statMembers">‚Äî</h3><p data-i18n="nav_members">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ß‡∏á</p></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon blue">üìÖ</div>
          <div class="stat-body"><h3 id="statJobs">‚Äî</h3><p data-i18n="upcomingJobs">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏°‡∏≤‡∏ñ‡∏∂‡∏á</p></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon green">üí∞</div>
          <div class="stat-body"><h3 id="statRevenue">‚Äî</h3><p data-i18n="revenueMonth">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon purple">üìÑ</div>
          <div class="stat-body"><h3 id="statQuotations">‚Äî</h3><p data-i18n="nav_quotation">‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</p></div>
        </div>
      </div>

      <div class="dash-row">
        <!-- Upcoming Jobs -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="upcomingJobs">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏°‡∏≤‡∏ñ‡∏∂‡∏á</h3>
            <a href="?page=schedule" class="btn btn-ghost btn-sm" data-i18n="viewAll">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a>
          </div>
          <div id="jobList">
            <div class="empty-state"><p data-i18n="noData">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p></div>
          </div>
        </div>

        <!-- Right column -->
        <div>
          <!-- Quick Actions -->
          <div class="card" style="margin-bottom:var(--spacing-xl)">
            <div class="card-header"><h3 class="card-title" data-i18n="quickActions">‡∏ó‡∏≤‡∏á‡∏•‡∏±‡∏î</h3></div>
            <div class="quick-actions">
              <button class="quick-btn" onclick="nav('schedule')">üìÖ <span data-i18n="nav_schedule">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô</span></button>
              <button class="quick-btn" onclick="nav('attendance-payroll')">üí≥ <span data-i18n="nav_payroll">‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</span></button>
              <button class="quick-btn" onclick="nav('quotation')">üìÉ <span data-i18n="nav_quotation">‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</span></button>
              <button class="quick-btn" onclick="nav('band-info')">üéµ <span data-i18n="nav_bandInfo">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏á</span></button>
              <button class="quick-btn" onclick="nav('songs')">üéº <span data-i18n="nav_songs">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏•‡∏á</span></button>
              <button class="quick-btn" onclick="nav('equipment')">üé∏ <span data-i18n="nav_equipment">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</span></button>
            </div>
          </div>
          <!-- Finance Summary -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title" data-i18n="financeThisMonth">‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h3>
              <a href="?page=statistics" class="btn btn-ghost btn-sm" data-i18n="viewAll">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a>
            </div>
            <div id="financeList"><div class="empty-state"><p data-i18n="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p></div></div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <?!= include('js_i18n') ?>
  <?!= include('js_app') ?>
  <?!= include('js_nav') ?>
  <script>
  function nav(page) {
    var isGas = typeof google !== 'undefined' && google.script;
    window.location.href = isGas ? '?page=' + page : page + '.html';
  }
  document.addEventListener('DOMContentLoaded', function() {
    requireAuth();
    renderMainNav('mainNav');
    applyTranslations();

    var name = localStorage.getItem('userName') || '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
    var band = localStorage.getItem('bandName') || '‡∏ß‡∏á‡∏î‡∏ô‡∏ï‡∏£‡∏µ';
    document.getElementById('welcomeName').textContent = '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, ' + name;
    document.getElementById('welcomeBand').textContent = 'üéµ ' + band;

    loadDashboard();
  });

  function loadDashboard() {
    gasRun('getDashboardSummary', {}, function(r) {
      if (!r || !r.success) return;
      var d = r.data || {};
      document.getElementById('statMembers').textContent = d.memberCount != null ? d.memberCount : '‚Äî';
      document.getElementById('statJobs').textContent = d.upcomingJobs != null ? d.upcomingJobs : '‚Äî';
      document.getElementById('statRevenue').textContent = d.revenueMonth != null ? formatCurrency(d.revenueMonth) : '‚Äî';
      document.getElementById('statQuotations').textContent = d.quotationCount != null ? d.quotationCount : '‚Äî';

      // jobs
      var jl = document.getElementById('jobList');
      if (d.jobs && d.jobs.length) {
        jl.innerHTML = d.jobs.slice(0,5).map(function(j) {
          var dt = new Date(j.date);
          var dd = isNaN(dt) ? '?' : dt.getDate();
          var mm = isNaN(dt) ? '' : dt.toLocaleString('th-TH',{month:'short'});
          return '<div class="job-item"><div class="job-date-box"><div class="dd">'+dd+'</div><div class="mm">'+mm+'</div></div>'
            +'<div class="job-info"><h4>'+escapeHtml(j.venue||'')+'</h4>'
            +'<p>'+escapeHtml(j.band||'')+' ¬∑ '+escapeHtml(j.type||'')+'</p></div></div>';
        }).join('');
      } else { jl.innerHTML = '<div class="empty-state"><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô</p></div>'; }

      // finance
      var fl = document.getElementById('financeList');
      var fin = d.finance || {};
      fl.innerHTML = [
        ['‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', formatCurrency(fin.income||0), 'val-pos'],
        ['‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', formatCurrency(fin.expense||0), 'val-neg'],
        ['‡∏Å‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏á', formatCurrency(fin.fund||0), ''],
        ['‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠', formatCurrency((fin.income||0)-(fin.expense||0)), (fin.income||0)>=(fin.expense||0)?'val-pos':'val-neg'],
      ].map(function(row){
        return '<div class="finance-row"><span class="label">'+row[0]+'</span><span class="'+row[2]+'">'+row[1]+'</span></div>';
      }).join('');
    });
  }
  </script>
</body>
</html>
